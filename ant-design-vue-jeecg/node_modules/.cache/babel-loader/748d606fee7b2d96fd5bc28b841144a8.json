{"remainingRequest":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js!D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\src\\views\\system\\modules\\GateWayRouteModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\src\\views\\system\\modules\\GateWayRouteModal.vue","mtime":1611914356000},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621061384845},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1621061377995},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621061384845},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1621061372054}],"contextDependencies":[],"result":["function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { postAction } from '@/api/manage';\nexport default {\n  name: 'GateWayRouteModal',\n  components: {},\n  data: function data() {\n    return {\n      layout: 'horizontal',\n      labelCol: {\n        span: 3\n      },\n      wrapperCol: {\n        span: 14\n      },\n      currentNameIndex: 0,\n      currentTagIndex: -1,\n      predicates: {},\n      filterArray: [{\n        key: 0,\n        name: '熔断器'\n      }, {\n        key: 1,\n        name: '限流过滤器'\n      }],\n      tagArray: ['Path', 'Host', 'Cookie', 'Header', 'Method', 'Query', 'After', 'Before', 'Between', 'RemoteAddr'],\n      inputVisible: false,\n      inputValue: '',\n      url: {\n        update: '/sys/gatewayRoute/updateAll',\n        clear: '/sys/gatewayRoute/clearRedis'\n      },\n      router: this.getRouter(),\n      title: '路由编辑',\n      visible: false,\n      loading: false\n    };\n  },\n  methods: {\n    getRouter: function getRouter() {\n      return {\n        routerId: '',\n        name: '',\n        uri: '',\n        predicates: [],\n        filters: []\n      };\n    },\n    show: function show(router) {\n      if (router) {\n        router.status = Boolean(router.status);\n        this.router = router;\n      } else {\n        this.router = this.getRouter();\n        this.inputValue = '';\n      }\n\n      this.visible = true;\n      this.currentTagIndex = -1;\n      this.currentNameIndex = -1;\n    },\n    close: function close() {\n      this.reset();\n      this.$emit('close');\n      this.$refs['form'].resetFields();\n      this.visible = false;\n    },\n    //删除路由条件配置项\n    removeTag: function removeTag(item, removedTag) {\n      var tags = item.args.filter(function (tag) {\n        return tag !== removedTag;\n      });\n      item.args = tags;\n    },\n    //添加路由选项\n    predicatesHandleMenuClick: function predicatesHandleMenuClick(e) {\n      this.router.predicates.push({\n        args: [],\n        name: e.key\n      });\n    },\n    editTag: function editTag(tag, index) {\n      this.currentTagIndex = index;\n    },\n    //显示输入框\n    showInput: function showInput(item, index) {\n      this.inputVisible = true;\n      this.currentNameIndex = index;\n    },\n    //路由选项输入框失去焦点事件\n    handleInputChange: function handleInputChange(e) {\n      this.inputValue = e.target.value;\n    },\n    //删除路由条件\n    removePredicate: function removePredicate(item, index) {\n      item.predicates.splice(index, 1);\n    },\n    //删除过滤器参数\n    removeFilterParams: function removeFilterParams(item, index) {\n      item.args.splice(index, 1);\n    },\n    //删除过滤器\n    removeFilter: function removeFilter(item, index) {\n      item.filters.splice(index, 1);\n    },\n    //添加过滤器参数\n    addFilterParams: function addFilterParams(item) {\n      item.args.push({\n        key: 'key' + item.args.length + 1,\n        value: ''\n      });\n    },\n    //过滤器添加事件\n    filterHandleMenuClick: function filterHandleMenuClick(e) {\n      if (e.key == 0) {\n        this.router.filters.push({\n          args: [{\n            key: 'name',\n            value: 'default'\n          }, {\n            key: 'fallbackUri',\n            value: 'forward:/fallback'\n          }],\n          name: 'Hystrix',\n          title: this.filterArray[0].name\n        });\n      }\n\n      if (e.key == 1) {\n        this.router.filters.push({\n          args: [{\n            key: 'key-resolver',\n            value: '#{@ipKeyResolver}'\n          }, {\n            key: 'redis-rate-limiter.replenishRate',\n            value: 20\n          }, {\n            key: 'redis-rate-limiter.burstCapacity',\n            value: 20\n          }],\n          name: \"RequestRateLimiter\",\n          title: this.filterArray[1].name\n        });\n      }\n    },\n    //输入框确认\n    handleInputConfirm: function handleInputConfirm(item) {\n      var inputValue = this.inputValue;\n      var tags = item.args;\n\n      if (inputValue && tags.indexOf(inputValue) === -1) {\n        item.args = [].concat(_toConsumableArray(tags), [inputValue]);\n      }\n\n      console.log(tags);\n      Object.assign(this, {\n        tags: tags,\n        inputVisible: false,\n        inputValue: ''\n      });\n      this.currentTagIndex = -1;\n    },\n    //输入框确认\n    handleInputEditConfirm: function handleInputEditConfirm(item, tag, index) {\n      if (this.inputValue) {\n        var inputValue = this.inputValue;\n        item.args[index] = inputValue;\n      }\n\n      this.currentTagIndex = -1;\n    },\n    reset: function reset() {\n      this.expandedKeysss = [];\n      this.checkedKeys = [];\n      this.defaultCheckedKeys = [];\n      this.loading = false;\n    },\n    //关闭弹窗\n    handleCancel: function handleCancel() {\n      this.close();\n    },\n    //提交路由\n    handleSubmit: function handleSubmit() {\n      var _this = this;\n\n      var _this$router = this.router,\n          predicates = _this$router.predicates,\n          filters = _this$router.filters,\n          other = _objectWithoutProperties(_this$router, [\"predicates\", \"filters\"]);\n\n      var router = other;\n      router.predicates = JSON.stringify(this.router.predicates);\n      router.filters = JSON.stringify(this.router.filters);\n      postAction(this.url.update, {\n        router: router\n      }).then(function (res) {\n        if (res.success) {\n          _this.close();\n\n          _this.$emit('ok');\n\n          _this.$message.success(res.message);\n        } else {\n          _this.$message.error(res.message);\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["GateWayRouteModal.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <a-drawer\n    :title=\"title\"\n    :maskClosable=\"true\"\n    width=\"45%\"\n    placement=\"right\"\n    v-if=\"visible\"\n    :closable=\"true\"\n    @close=\"handleCancel\"\n    :visible=\"visible\"\n    style=\"overflow: auto;padding-bottom: 53px;\">\n    <a-form-model ref=\"form\" :layout=\"layout\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" :model=\"router\">\n      <a-form-model-item label=\"路由ID\">\n        <a-input v-model=\"router.routerId\" placeholder=\"路由唯一ID\"/>\n      </a-form-model-item>\n      <a-form-model-item label=\"路由名称\">\n        <a-input v-model=\"router.name\" placeholder=\"路由名称\"/>\n      </a-form-model-item>\n      <a-form-model-item label=\"路由URI\">\n        <a-input v-model=\"router.uri\" placeholder=\"路由URL\"/>\n      </a-form-model-item>\n      <a-form-model-item label=\"路由状态\" prop=\"status\">\n        <a-switch default-checked v-model=\"router.status\"/>\n      </a-form-model-item>\n\n      <a-form-model-item prop=\"predicates\" label=\"路由条件\">\n        <div v-for=\"(item,index) in router.predicates\">\n          <a-divider>{{item.name}}\n            <a-icon type=\"delete\" size=\"22\" @click=\"removePredicate(router,index)\"/>\n          </a-divider>\n          <div>\n            <template v-for=\"(tag, index) in item.args\">\n              <a-input v-if=\"index==currentTagIndex\" ref=\"input\" type=\"text\" size=\"small\"\n                       :style=\"{ width: '190px' }\"\n                       :value=\"tag\"\n                       @change=\"handleInputChange\" @blur=\"handleInputEditConfirm(item,tag,index)\"\n                       @keyup.enter=\"handleInputEditConfirm(item,tag,index)\"/>\n              <a-tag v-else :key=\"tag\" :closable=\"true\" @close=\"() => removeTag(item,tag)\" @click=\"editTag(tag,index)\">\n                {{ tag }}\n              </a-tag>\n            </template>\n            <a-input v-if=\"inputVisible&&index==currentNameIndex\" ref=\"input\" type=\"text\" size=\"small\"\n                     :style=\"{ width: '100px' }\"\n                     :value=\"inputValue\"\n                     @change=\"handleInputChange\" @blur=\"handleInputConfirm(item)\"\n                     @keyup.enter=\"handleInputConfirm(item)\"/>\n            <a-tag v-else style=\"background: #fff; borderStyle: dashed;\" @click=\"showInput(item,index)\">\n              <a-icon type=\"plus\"/>\n              新建{{item.name}}\n            </a-tag>\n          </div>\n        </div>\n        <p class=\"btn\" style=\"padding-top: 10px\">\n          <a-dropdown>\n            <a-menu slot=\"overlay\" @click=\"predicatesHandleMenuClick\">\n              <a-menu-item :key=\"item\" v-for=\"item in tagArray\">{{item}}</a-menu-item>\n            </a-menu>\n            <a-button type=\"dashed\" style=\"margin-left: 8px;width:100%\"> 添加路由条件\n              <a-icon type=\"down\"/>\n            </a-button>\n          </a-dropdown>\n        </p>\n      </a-form-model-item>\n      <a-form-model-item prop=\"predicates\" label=\"过滤器\">\n        <div v-for=\"(item,index) in router.filters\">\n          <a-divider>{{item.name}}\n            <a-icon type=\"delete\" size=\"22\" @click=\"removeFilter(router,index)\"/>\n          </a-divider>\n          <div v-for=\"(tag, index) in item.args\" :key=\"tag.key\">\n            <a-input v-model=\"tag.key\" placeholder=\"参数键\" style=\"width: 45%; margin-right: 8px\"/>\n            <a-input v-model=\"tag.value\" placeholder=\"参数值\" style=\"width: 40%; margin-right: 8px\"/>\n            <a-icon class=\"dynamic-delete-button\" type=\"minus-circle-o\" @click=\"removeFilterParams(item,index)\"/>\n          </div>\n          <a-button type=\"dashed\" style=\"margin-left:28%;width: 30%\" size=\"small\" @click=\"addFilterParams(item)\">\n            <a-icon type=\"plus\"/>\n            添加参数\n          </a-button>\n        </div>\n        <p class=\"btn\" style=\"padding-top: 10px\">\n          <a-dropdown>\n            <a-menu slot=\"overlay\" @click=\"filterHandleMenuClick\">\n              <a-menu-item :key=\"item.key\" :name=\"item.name\" v-for=\"item in filterArray\">{{item.name}}</a-menu-item>\n            </a-menu>\n            <a-button type=\"dashed\" style=\"margin-left: 8px;width:100%\"> 添加过滤器\n              <a-icon type=\"down\"/>\n            </a-button>\n          </a-dropdown>\n        </p>\n      </a-form-model-item>\n      <a-row :style=\"{textAlign:'right'}\" class=\"drawer-bootom-button\">\n        <a-button :style=\"{marginRight: '8px'}\" @click=\"handleCancel\">\n          关闭\n        </a-button>\n        <a-button @click=\"handleSubmit\" type=\"primary\">确定</a-button>\n      </a-row>\n    </a-form-model>\n\n  </a-drawer>\n\n</template>\n<script>\n\n  import { postAction } from '@/api/manage'\n\n  export default {\n    name: 'GateWayRouteModal',\n    components: {},\n    data() {\n      return {\n        layout: 'horizontal',\n        labelCol: { span: 3 },\n        wrapperCol: { span: 14 },\n        currentNameIndex: 0,\n        currentTagIndex:-1,\n        predicates: {},\n        filterArray: [{ key: 0, name: '熔断器' }, { key: 1, name: '限流过滤器' }],\n        tagArray: ['Path', 'Host', 'Cookie', 'Header', 'Method', 'Query', 'After', 'Before', 'Between', 'RemoteAddr'],\n        inputVisible: false,\n        inputValue: '',\n        url: {\n          update: '/sys/gatewayRoute/updateAll',\n          clear: '/sys/gatewayRoute/clearRedis'\n        },\n        router: this.getRouter(),\n        title: '路由编辑',\n        visible: false,\n        loading: false\n      }\n    },\n    methods: {\n      getRouter() {\n        return {\n          routerId: '',\n          name: '',\n          uri: '',\n          predicates: [],\n          filters: []\n        }\n      },\n      show(router) {\n        if (router) {\n          router.status=Boolean(router.status)\n          this.router = router\n        } else {\n          this.router = this.getRouter()\n          this.inputValue=''\n        }\n        this.visible = true\n        this.currentTagIndex=-1\n        this.currentNameIndex=-1\n      },\n      close() {\n        this.reset()\n        this.$emit('close')\n        this.$refs['form'].resetFields()\n        this.visible = false\n      },\n      //删除路由条件配置项\n      removeTag(item, removedTag) {\n        const tags = item.args.filter(tag => tag !== removedTag)\n        item.args = tags\n      },\n      //添加路由选项\n      predicatesHandleMenuClick(e) {\n        this.router.predicates.push({\n          args: [],\n          name: e.key\n        })\n      },\n      editTag(tag,index){\n        this.currentTagIndex=index\n      },\n      //显示输入框\n      showInput(item, index) {\n        this.inputVisible = true\n        this.currentNameIndex = index\n      },\n      //路由选项输入框失去焦点事件\n      handleInputChange(e) {\n        this.inputValue = e.target.value\n      },\n      //删除路由条件\n      removePredicate(item, index) {\n        item.predicates.splice(index, 1)\n      },\n      //删除过滤器参数\n      removeFilterParams(item, index) {\n        item.args.splice(index, 1)\n      },\n      //删除过滤器\n      removeFilter(item, index) {\n        item.filters.splice(index, 1)\n      },\n      //添加过滤器参数\n      addFilterParams(item) {\n        item.args.push({\n          key: 'key' + item.args.length + 1,\n          value: ''\n        })\n      },\n      //过滤器添加事件\n      filterHandleMenuClick(e) {\n        if (e.key == 0) {\n          this.router.filters.push({\n            args: [  {\n              key: 'name',\n              value: 'default'\n            },{\n              key: 'fallbackUri',\n              value: 'forward:/fallback'\n            }],\n            name:'Hystrix',\n            title: this.filterArray[0].name\n          })\n        }\n        if (e.key == 1) {\n          this.router.filters.push({\n            args: [ {\n              key: 'key-resolver',\n              value: '#{@ipKeyResolver}'\n            }, {\n              key: 'redis-rate-limiter.replenishRate',\n              value: 20\n            }, {\n              key: 'redis-rate-limiter.burstCapacity',\n              value: 20\n            }],\n            name:\"RequestRateLimiter\",\n            title: this.filterArray[1].name\n          })\n        }\n      },\n      //输入框确认\n      handleInputConfirm(item) {\n        const inputValue = this.inputValue\n        let tags = item.args\n        if (inputValue && tags.indexOf(inputValue) === -1) {\n          item.args = [...tags, inputValue]\n        }\n        console.log(tags)\n        Object.assign(this, {\n          tags,\n          inputVisible: false,\n          inputValue: ''\n        })\n        this.currentTagIndex=-1\n      },\n      //输入框确认\n      handleInputEditConfirm(item,tag,index) {\n        if(this.inputValue)\n        {\n          const inputValue = this.inputValue\n          item.args[index]=inputValue\n        }\n        this.currentTagIndex=-1\n\n      },\n      reset() {\n        this.expandedKeysss = []\n        this.checkedKeys = []\n        this.defaultCheckedKeys = []\n        this.loading = false\n      },\n      //关闭弹窗\n      handleCancel() {\n        this.close()\n      },\n      //提交路由\n      handleSubmit() {\n        let { predicates, filters, ...other } = this.router\n        let router = other\n        router.predicates = JSON.stringify(this.router.predicates)\n        router.filters = JSON.stringify(this.router.filters)\n        postAction(this.url.update, {\n          router\n        }).then(res => {\n          if (res.success) {\n            this.close()\n            this.$emit('ok')\n            this.$message.success(res.message)\n          } else {\n            this.$message.error(res.message)\n          }\n        })\n\n      }\n    }\n  }\n\n</script>\n<style lang=\"less\" scoped>\n  .drawer-bootom-button {\n    position: absolute;\n    bottom: 0;\n    width: 100%;\n    border-top: 1px solid #e8e8e8;\n    padding: 10px 16px;\n    text-align: right;\n    left: 0;\n    background: #fff;\n    border-radius: 0 0 2px 2px;\n  }\n</style>"],"sourceRoot":"src/views/system/modules"}]}