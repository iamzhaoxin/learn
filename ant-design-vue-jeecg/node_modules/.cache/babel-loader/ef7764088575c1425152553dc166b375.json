{"remainingRequest":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js!D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\src\\utils\\authFilter.js","dependencies":[{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\src\\utils\\authFilter.js","mtime":1611914356000},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621061384845},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1621061377995},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1617935819779}],"contextDependencies":[],"result":["import { USER_AUTH, SYS_BUTTON_AUTH } from \"@/store/mutation-types\";\nexport function disabledAuthFilter(code, formData) {\n  if (nodeDisabledAuth(code, formData)) {\n    return true;\n  } else {\n    return globalDisabledAuth(code);\n  }\n}\n\nfunction nodeDisabledAuth(code, formData) {\n  console.log(\"页面权限禁用--NODE--开始\");\n  var permissionList = [];\n\n  try {\n    console.log(\"页面权限禁用--NODE--开始\", formData);\n\n    if (formData) {\n      var bpmList = formData.permissionList;\n      permissionList = bpmList.filter(function (item) {\n        return item.type == '2';\n      }); // for (let bpm of bpmList) {\n      //   if(bpm.type == '2') {\n      //     permissionList.push(bpm);\n      //   }\n      // }\n    } else {\n      return false;\n    }\n  } catch (e) {//console.log(\"页面权限异常----\", e);\n  }\n\n  if (permissionList.length == 0) {\n    return false;\n  }\n\n  console.log(\"流程节点页面权限禁用--NODE--开始\");\n  var permissions = [];\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = permissionList[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var item = _step.value;\n\n      if (item.type == '2') {\n        permissions.push(item.action);\n      }\n    } //console.log(\"页面权限----\"+code);\n\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  if (!permissions.includes(code)) {\n    return false;\n  } else {\n    var _iteratorNormalCompletion2 = true;\n    var _didIteratorError2 = false;\n    var _iteratorError2 = undefined;\n\n    try {\n      for (var _iterator2 = permissionList[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n        var item2 = _step2.value;\n\n        if (code === item2.action) {\n          console.log(\"流程节点页面权限禁用--NODE--生效\");\n          return true;\n        }\n      }\n    } catch (err) {\n      _didIteratorError2 = true;\n      _iteratorError2 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n          _iterator2.return();\n        }\n      } finally {\n        if (_didIteratorError2) {\n          throw _iteratorError2;\n        }\n      }\n    }\n  }\n\n  return false;\n}\n\nfunction globalDisabledAuth(code) {\n  console.log(\"全局页面禁用权限--Global--开始\");\n  var permissionList = [];\n  var allPermissionList = []; //let authList = Vue.ls.get(USER_AUTH);\n\n  var authList = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\");\n  var _iteratorNormalCompletion3 = true;\n  var _didIteratorError3 = false;\n  var _iteratorError3 = undefined;\n\n  try {\n    for (var _iterator3 = authList[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n      var auth = _step3.value;\n\n      if (auth.type == '2') {\n        permissionList.push(auth);\n      }\n    } //console.log(\"页面禁用权限--Global--\",sessionStorage.getItem(SYS_BUTTON_AUTH));\n\n  } catch (err) {\n    _didIteratorError3 = true;\n    _iteratorError3 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n        _iterator3.return();\n      }\n    } finally {\n      if (_didIteratorError3) {\n        throw _iteratorError3;\n      }\n    }\n  }\n\n  var allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n  var _iteratorNormalCompletion4 = true;\n  var _didIteratorError4 = false;\n  var _iteratorError4 = undefined;\n\n  try {\n    for (var _iterator4 = allAuthList[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n      var gauth = _step4.value;\n\n      if (gauth.type == '2') {\n        allPermissionList.push(gauth);\n      }\n    } //设置全局配置是否有命中\n\n  } catch (err) {\n    _didIteratorError4 = true;\n    _iteratorError4 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion4 && _iterator4.return != null) {\n        _iterator4.return();\n      }\n    } finally {\n      if (_didIteratorError4) {\n        throw _iteratorError4;\n      }\n    }\n  }\n\n  var gFlag = false; //禁用命中\n\n  var invalidFlag = false; //无效命中\n\n  if (allPermissionList != null && allPermissionList != \"\" && allPermissionList != undefined && allPermissionList.length > 0) {\n    var _iteratorNormalCompletion5 = true;\n    var _didIteratorError5 = false;\n    var _iteratorError5 = undefined;\n\n    try {\n      for (var _iterator5 = allPermissionList[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n        var itemG = _step5.value;\n\n        if (code === itemG.action) {\n          if (itemG.status == '0') {\n            invalidFlag = true;\n            break;\n          } else {\n            gFlag = true;\n            break;\n          }\n        }\n      }\n    } catch (err) {\n      _didIteratorError5 = true;\n      _iteratorError5 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion5 && _iterator5.return != null) {\n          _iterator5.return();\n        }\n      } finally {\n        if (_didIteratorError5) {\n          throw _iteratorError5;\n        }\n      }\n    }\n  }\n\n  if (invalidFlag) {\n    return false;\n  }\n\n  if (permissionList === null || permissionList === \"\" || permissionList === undefined || permissionList.length <= 0) {\n    return gFlag;\n  }\n\n  var permissions = [];\n\n  for (var _i = 0, _permissionList = permissionList; _i < _permissionList.length; _i++) {\n    var item = _permissionList[_i];\n\n    if (item.type == '2') {\n      permissions.push(item.action);\n    }\n  } //console.log(\"页面禁用权限----\"+code);\n\n\n  if (!permissions.includes(code)) {\n    return gFlag;\n  } else {\n    var _iteratorNormalCompletion6 = true;\n    var _didIteratorError6 = false;\n    var _iteratorError6 = undefined;\n\n    try {\n      for (var _iterator6 = permissionList[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n        var item2 = _step6.value;\n\n        if (code === item2.action) {\n          console.log(\"全局页面权限解除禁用--Global--生效\");\n          gFlag = false;\n        }\n      }\n    } catch (err) {\n      _didIteratorError6 = true;\n      _iteratorError6 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion6 && _iterator6.return != null) {\n          _iterator6.return();\n        }\n      } finally {\n        if (_didIteratorError6) {\n          throw _iteratorError6;\n        }\n      }\n    }\n\n    return gFlag;\n  }\n}\n\nexport function colAuthFilter(columns, pre) {\n  var authList = getNoAuthCols(pre);\n  var cols = columns.filter(function (item) {\n    if (hasColoum(item, authList)) {\n      return true;\n    }\n\n    return false;\n  });\n  return cols;\n}\n/**\n * 【子表行编辑】实现两个功能：\n * 1、隐藏JEditableTable无权限的字段\n * 2、禁用JEditableTable无权限的字段\n * @param columns\n * @param pre\n * @returns {*}\n */\n\nexport function colAuthFilterJEditableTable(columns, pre) {\n  var authList = getAllShowAndDisabledAuthCols(pre);\n  var cols = columns.filter(function (item) {\n    var oneAuth = authList.find(function (auth) {\n      return auth.action === pre + item.key;\n    });\n\n    if (!oneAuth) {\n      return true;\n    } //代码严谨处理，防止一个授权标识，配置多次\n\n\n    if (oneAuth instanceof Array) {\n      oneAuth = oneAuth[0];\n    } //禁用逻辑\n\n\n    if (oneAuth.type == '2' && !oneAuth.isAuth) {\n      item[\"disabled\"] = true;\n      return true;\n    } //隐藏逻辑逻辑\n\n\n    if (oneAuth.type == '1' && !oneAuth.isAuth) {\n      return false;\n    }\n\n    return true;\n  });\n  return cols;\n}\n\nfunction hasColoum(item, authList) {\n  if (authList.includes(item.dataIndex)) {\n    return false;\n  }\n\n  return true;\n} //权限无效时不做控制，有效时控制，只能控制 显示不显示\n//根据授权码前缀获取未授权的列信息\n\n\nexport function getNoAuthCols(pre) {\n  if (!pre || pre.length == 0) {\n    return [];\n  }\n\n  var permissionList = [];\n  var allPermissionList = []; //let authList = Vue.ls.get(USER_AUTH);\n\n  var authList = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\");\n  var _iteratorNormalCompletion7 = true;\n  var _didIteratorError7 = false;\n  var _iteratorError7 = undefined;\n\n  try {\n    for (var _iterator7 = authList[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n      var auth = _step7.value;\n\n      //显示策略，有效状态\n      if (auth.type == '1' && startWith(auth.action, pre)) {\n        permissionList.push(substrPre(auth.action, pre));\n      }\n    } //console.log(\"页面禁用权限--Global--\",sessionStorage.getItem(SYS_BUTTON_AUTH));\n\n  } catch (err) {\n    _didIteratorError7 = true;\n    _iteratorError7 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion7 && _iterator7.return != null) {\n        _iterator7.return();\n      }\n    } finally {\n      if (_didIteratorError7) {\n        throw _iteratorError7;\n      }\n    }\n  }\n\n  var allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n  var _iteratorNormalCompletion8 = true;\n  var _didIteratorError8 = false;\n  var _iteratorError8 = undefined;\n\n  try {\n    for (var _iterator8 = allAuthList[Symbol.iterator](), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n      var gauth = _step8.value;\n\n      //显示策略，有效状态\n      if (gauth.type == '1' && gauth.status == '1' && startWith(gauth.action, pre)) {\n        allPermissionList.push(substrPre(gauth.action, pre));\n      }\n    }\n  } catch (err) {\n    _didIteratorError8 = true;\n    _iteratorError8 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion8 && _iterator8.return != null) {\n        _iterator8.return();\n      }\n    } finally {\n      if (_didIteratorError8) {\n        throw _iteratorError8;\n      }\n    }\n  }\n\n  var cols = allPermissionList.filter(function (item) {\n    if (permissionList.includes(item)) {\n      return false;\n    }\n\n    return true;\n  });\n  return cols;\n}\n/**\n * 额外增加方法【用于行编辑组件】\n * date: 2020-04-05\n * author: scott\n * @param pre\n * @returns {*[]}\n */\n\nfunction getAllShowAndDisabledAuthCols(pre) {\n  //用户拥有的权限\n  var userAuthList = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\"); //全部权限配置\n\n  var allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n  var newAllAuthList = allAuthList.map(function (item, index) {\n    var hasAuthArray = userAuthList.filter(function (u) {\n      return u.action === item.action;\n    });\n\n    if (hasAuthArray && hasAuthArray.length > 0) {\n      item[\"isAuth\"] = true;\n    }\n\n    return item;\n  });\n  return newAllAuthList;\n}\n\nfunction startWith(str, pre) {\n  if (pre == null || pre == \"\" || str == null || str == \"\" || str.length == 0 || pre.length > str.length) return false;\n  if (str.substr(0, pre.length) == pre) return true;else return false;\n}\n\nfunction substrPre(str, pre) {\n  return str.substr(pre.length);\n}",{"version":3,"sources":["D:/activiti/project01/jeecg-boot-activiti-master/ant-design-vue-jeecg/src/utils/authFilter.js"],"names":["USER_AUTH","SYS_BUTTON_AUTH","disabledAuthFilter","code","formData","nodeDisabledAuth","globalDisabledAuth","console","log","permissionList","bpmList","filter","item","type","e","length","permissions","push","action","includes","item2","allPermissionList","authList","JSON","parse","sessionStorage","getItem","auth","allAuthList","gauth","gFlag","invalidFlag","undefined","itemG","status","colAuthFilter","columns","pre","getNoAuthCols","cols","hasColoum","colAuthFilterJEditableTable","getAllShowAndDisabledAuthCols","oneAuth","find","key","Array","isAuth","dataIndex","startWith","substrPre","userAuthList","newAllAuthList","map","index","hasAuthArray","u","str","substr"],"mappings":"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","sourcesContent":["import { USER_AUTH,SYS_BUTTON_AUTH } from \"@/store/mutation-types\"\n\nexport function disabledAuthFilter(code,formData) {\n  if(nodeDisabledAuth(code,formData)){\n    return true;\n  }else{\n    return globalDisabledAuth(code);\n  }\n}\n\nfunction nodeDisabledAuth(code,formData){\n  console.log(\"页面权限禁用--NODE--开始\");\n  let permissionList = [];\n  try {\n    console.log(\"页面权限禁用--NODE--开始\",formData);\n    if (formData) {\n      let bpmList = formData.permissionList;\n      permissionList = bpmList.filter(item=>item.type=='2')\n      // for (let bpm of bpmList) {\n      //   if(bpm.type == '2') {\n      //     permissionList.push(bpm);\n      //   }\n      // }\n    }else{\n      return false;\n    }\n  } catch (e) {\n    //console.log(\"页面权限异常----\", e);\n  }\n  if (permissionList.length ==  0) {\n    return false;\n  }\n\n  console.log(\"流程节点页面权限禁用--NODE--开始\");\n  let permissions = [];\n  for (let item of permissionList) {\n    if(item.type == '2') {\n      permissions.push(item.action);\n    }\n  }\n  //console.log(\"页面权限----\"+code);\n  if (!permissions.includes(code)) {\n    return false;\n  }else{\n    for (let item2 of permissionList) {\n      if(code === item2.action){\n        console.log(\"流程节点页面权限禁用--NODE--生效\");\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nfunction globalDisabledAuth(code){\n  console.log(\"全局页面禁用权限--Global--开始\");\n\n  let permissionList = [];\n  let allPermissionList = [];\n\n  //let authList = Vue.ls.get(USER_AUTH);\n  let authList = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\");\n  for (let auth of authList) {\n    if(auth.type == '2') {\n      permissionList.push(auth);\n    }\n  }\n  //console.log(\"页面禁用权限--Global--\",sessionStorage.getItem(SYS_BUTTON_AUTH));\n  let allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n  for (let gauth of allAuthList) {\n    if(gauth.type == '2') {\n      allPermissionList.push(gauth);\n    }\n  }\n  //设置全局配置是否有命中\n  let  gFlag = false;//禁用命中\n  let invalidFlag = false;//无效命中\n  if(allPermissionList != null && allPermissionList != \"\" && allPermissionList != undefined && allPermissionList.length > 0){\n    for (let itemG of allPermissionList) {\n      if(code === itemG.action){\n        if(itemG.status == '0'){\n          invalidFlag = true;\n          break;\n        }else{\n          gFlag = true;\n          break;\n        }\n      }\n    }\n  }\n  if(invalidFlag){\n    return false;\n  }\n  if (permissionList === null || permissionList === \"\" || permissionList === undefined||permissionList.length<=0) {\n    return gFlag;\n  }\n  let permissions = [];\n  for (let item of permissionList) {\n    if(item.type == '2') {\n      permissions.push(item.action);\n    }\n  }\n  //console.log(\"页面禁用权限----\"+code);\n  if (!permissions.includes(code)) {\n    return gFlag;\n  }else{\n    for (let item2 of permissionList) {\n      if(code === item2.action){\n        console.log(\"全局页面权限解除禁用--Global--生效\");\n        gFlag = false;\n      }\n    }\n    return gFlag;\n  }\n}\n\n\n\nexport function colAuthFilter(columns,pre) {\n  let authList = getNoAuthCols(pre);\n  const cols = columns.filter(item => {\n    if (hasColoum(item,authList)) {\n      return true\n    }\n    return false\n  })\n  return cols\n}\n\n/**\n * 【子表行编辑】实现两个功能：\n * 1、隐藏JEditableTable无权限的字段\n * 2、禁用JEditableTable无权限的字段\n * @param columns\n * @param pre\n * @returns {*}\n */\nexport function colAuthFilterJEditableTable(columns,pre) {\n  let authList = getAllShowAndDisabledAuthCols(pre);\n  const cols = columns.filter(item => {\n    let oneAuth = authList.find(auth => {\n      return auth.action === pre + item.key;\n    });\n    if(!oneAuth){\n      return true\n    }\n\n    //代码严谨处理，防止一个授权标识，配置多次\n    if(oneAuth instanceof Array){\n      oneAuth = oneAuth[0]\n    }\n\n    //禁用逻辑\n    if (oneAuth.type == '2' && !oneAuth.isAuth) {\n      item[\"disabled\"] = true\n      return true\n    }\n    //隐藏逻辑逻辑\n    if (oneAuth.type == '1' && !oneAuth.isAuth) {\n      return false\n    }\n    return true\n  })\n  return cols\n}\n\n\nfunction hasColoum(item,authList){\n  if (authList.includes(item.dataIndex)) {\n    return false\n  }\n  return true\n}\n\n//权限无效时不做控制，有效时控制，只能控制 显示不显示\n//根据授权码前缀获取未授权的列信息\nexport function getNoAuthCols(pre){\n  if(!pre || pre.length==0){\n    return []\n  }\n  let permissionList = [];\n  let allPermissionList = [];\n\n  //let authList = Vue.ls.get(USER_AUTH);\n  let authList = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\");\n  for (let auth of authList) {\n    //显示策略，有效状态\n    if(auth.type == '1'&&startWith(auth.action,pre)) {\n      permissionList.push(substrPre(auth.action,pre));\n    }\n  }\n  //console.log(\"页面禁用权限--Global--\",sessionStorage.getItem(SYS_BUTTON_AUTH));\n  let allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n  for (let gauth of allAuthList) {\n    //显示策略，有效状态\n    if(gauth.type == '1'&&gauth.status == '1'&&startWith(gauth.action,pre)) {\n      allPermissionList.push(substrPre(gauth.action,pre));\n    }\n  }\n  const cols = allPermissionList.filter(item => {\n    if (permissionList.includes(item)) {\n      return false;\n    }\n    return true;\n  })\n  return cols;\n}\n\n\n\n/**\n * 额外增加方法【用于行编辑组件】\n * date: 2020-04-05\n * author: scott\n * @param pre\n * @returns {*[]}\n */\nfunction getAllShowAndDisabledAuthCols(pre){\n  //用户拥有的权限\n  let userAuthList = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\");\n  //全部权限配置\n  let allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n\n  let newAllAuthList = allAuthList.map(function (item, index) {\n    let hasAuthArray = userAuthList.filter(u => u.action===item.action );\n    if (hasAuthArray && hasAuthArray.length>0) {\n      item[\"isAuth\"] = true\n    }\n    return item;\n  })\n\n  return newAllAuthList;\n}\n\nfunction startWith(str,pre) {\n  if (pre == null || pre == \"\" || str==null|| str==\"\"|| str.length == 0 || pre.length > str.length)\n    return false;\n  if (str.substr(0, pre.length) == pre)\n    return true;\n  else\n    return false;\n}\n\nfunction substrPre(str,pre) {\n  return str.substr(pre.length);\n}"]}]}