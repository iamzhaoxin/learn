{"remainingRequest":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js!D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\src\\components\\JVxeCells\\JVxeFileCell.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\src\\components\\JVxeCells\\JVxeFileCell.vue","mtime":1611914356000},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621061384845},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1621061377995},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621061384845},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1621061372054}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getFileAccessHttpUrl } from '@api/manage';\nimport JVxeCellMixins from '@/components/jeecg/JVxeTable/mixins/JVxeCellMixins';\nimport { ACCESS_TOKEN } from '@/store/mutation-types';\nimport JFilePop from '@/components/jeecg/minipop/JFilePop';\nimport JVxeUploadCell from '@/components/jeecg/JVxeTable/components/cells/JVxeUploadCell';\nexport default {\n  name: 'JVxeFileCell',\n  mixins: [JVxeCellMixins],\n  components: {\n    JFilePop: JFilePop\n  },\n  props: {},\n  data: function data() {\n    return {\n      innerFile: null,\n      number: 0\n    };\n  },\n  computed: {\n    /** upload headers */\n    uploadHeaders: function uploadHeaders() {\n      var col = this.originColumn;\n      var headers = {};\n\n      if (col.token === true) {\n        headers['X-Access-Token'] = this.$ls.get(ACCESS_TOKEN);\n      }\n\n      return headers;\n    },\n\n    /** 上传请求地址 */\n    uploadAction: function uploadAction() {\n      if (!this.originColumn.action) {\n        return window._CONFIG['domianURL'] + '/sys/common/upload';\n      } else {\n        return this.originColumn.action;\n      }\n    },\n    hasFile: function hasFile() {\n      return this.innerFile != null;\n    },\n    ellipsisFileName: function ellipsisFileName() {\n      var length = 5;\n      var file = this.innerFile;\n\n      if (!file || !file.name) {\n        return '';\n      }\n\n      if (file.name.length > length) {\n        return file.name.substr(0, length) + '…';\n      }\n\n      return file.name;\n    },\n    responseName: function responseName() {\n      if (this.originColumn.responseName) {\n        return this.originColumn.responseName;\n      } else {\n        return 'message';\n      }\n    }\n  },\n  watch: {\n    innerValue: {\n      immediate: true,\n      handler: function handler() {\n        if (this.innerValue) {\n          this.innerFile = this.innerValue;\n        } else {\n          this.innerFile = null;\n        }\n      }\n    }\n  },\n  methods: {\n    // 点击更多按钮\n    handleMoreOperation: function handleMoreOperation(originColumn) {\n      //update-begin-author:wangshuai date:20201021 for:LOWCOD-969 判断传过来的字段是否存在number，用于控制上传文件\n      if (originColumn.number) {\n        this.number = originColumn.number;\n      } else {\n        this.number = 0;\n      } //update-end-author:wangshuai date:20201021 for:LOWCOD-969 判断传过来的字段是否存在number，用于控制上传文件\n\n\n      if (originColumn && originColumn.fieldExtendJson) {\n        var json = JSON.parse(originColumn.fieldExtendJson);\n        this.number = json.uploadnum ? json.uploadnum : 0;\n      }\n\n      var path = '';\n\n      if (this.innerFile) {\n        path = this.innerFile.path;\n      }\n\n      this.$refs.filePop.show('', path);\n    },\n    // 更多上传回调\n    handleFileSuccess: function handleFileSuccess(file) {\n      if (file) {\n        this.innerFile.path = file.path;\n        this.handleChangeCommon(this.innerFile);\n      }\n    },\n    handleChangeUpload: function handleChangeUpload(info) {\n      var col = this.originColumn;\n      var file = info.file;\n      var value = {\n        name: file.name,\n        type: file.type,\n        size: file.size,\n        status: file.status,\n        percent: file.percent\n      };\n\n      if (file.response) {\n        value['responseName'] = file.response[this.responseName];\n      }\n\n      if (file.status === 'done') {\n        value['path'] = file.response[this.responseName];\n        this.handleChangeCommon(value);\n      } else if (file.status === 'error') {\n        value['message'] = file.response.message || '未知错误';\n      }\n\n      this.innerFile = value;\n    },\n    handleClickDownloadFile: function handleClickDownloadFile() {\n      var _ref = this.innerFile || {},\n          url = _ref.url,\n          path = _ref.path;\n\n      if (!url || url.length === 0) {\n        if (path && path.length > 0) {\n          url = getFileAccessHttpUrl(path.split(',')[0]);\n        }\n      }\n\n      if (url) {\n        window.open(url);\n      }\n    },\n    handleClickDeleteFile: function handleClickDeleteFile() {\n      this.handleChangeCommon(null);\n    }\n  },\n  // 【组件增强】注释详见：JVxeCellMixins.js\n  enhanced: {\n    switches: {\n      visible: true\n    },\n    getValue: function getValue(value) {\n      return JVxeUploadCell.enhanced.getValue(value);\n    },\n    setValue: function setValue(value) {\n      return JVxeUploadCell.enhanced.setValue(value);\n    }\n  }\n};",{"version":3,"sources":["JVxeFileCell.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <template v-if=\"hasFile\" v-for=\"(file, fileKey) of [innerFile || {}]\">\n      <div :key=\"fileKey\" style=\"position: relative;\">\n        <a-tooltip v-if=\"file.status==='uploading'\" :title=\"`上传中(${Math.floor(file.percent)}%)`\">\n          <a-icon type=\"loading\"/>\n          <span style=\"margin-left:5px\">上传中…</span>\n        </a-tooltip>\n\n        <a-tooltip v-else-if=\"file.status==='done'\" :title=\"file.name\">\n          <a-icon type=\"paper-clip\"/>\n          <span style=\"margin-left:5px\">{{ ellipsisFileName }}</span>\n        </a-tooltip>\n\n        <a-tooltip v-else :title=\"file.name\">\n          <a-icon type=\"paper-clip\" style=\"color:red;\"/>\n          <span style=\"color:red;margin-left:5px\">{{ ellipsisFileName }}</span>\n        </a-tooltip>\n\n        <template style=\"width: 30px\">\n          <a-dropdown :trigger=\"['click']\" placement=\"bottomRight\" style=\"margin-left: 10px;\">\n            <a-tooltip title=\"操作\">\n              <a-icon\n                v-if=\"file.status!=='uploading'\"\n                type=\"setting\"\n                style=\"cursor: pointer;\"/>\n            </a-tooltip>\n\n            <a-menu slot=\"overlay\">\n              <a-menu-item v-if=\"originColumn.allowDownload !== false\" @click=\"handleClickDownloadFile\">\n                <span><a-icon type=\"download\"/>&nbsp;下载</span>\n              </a-menu-item>\n              <a-menu-item v-if=\"originColumn.allowRemove !== false\" @click=\"handleClickDeleteFile\">\n                <span><a-icon type=\"delete\"/>&nbsp;删除</span>\n              </a-menu-item>\n              <a-menu-item @click=\"handleMoreOperation(originColumn)\">\n                <span><a-icon type=\"bars\"/> 更多</span>\n              </a-menu-item>\n            </a-menu>\n          </a-dropdown>\n        </template>\n      </div>\n    </template>\n\n    <a-upload\n      v-show=\"!hasFile\"\n      name=\"file\"\n      :data=\"{'isup': 1}\"\n      :multiple=\"false\"\n      :action=\"uploadAction\"\n      :headers=\"uploadHeaders\"\n      :showUploadList=\"false\"\n      v-bind=\"cellProps\"\n      @change=\"handleChangeUpload\"\n    >\n      <a-button icon=\"upload\">{{originColumn.btnText || '上传文件'}}</a-button>\n    </a-upload>\n    <j-file-pop ref=\"filePop\" @ok=\"handleFileSuccess\" :number=\"number\"/>\n  </div>\n</template>\n\n<script>\n  import { getFileAccessHttpUrl } from '@api/manage'\n  import JVxeCellMixins from '@/components/jeecg/JVxeTable/mixins/JVxeCellMixins'\n  import { ACCESS_TOKEN } from '@/store/mutation-types'\n  import JFilePop from '@/components/jeecg/minipop/JFilePop'\n\n  import JVxeUploadCell from '@/components/jeecg/JVxeTable/components/cells/JVxeUploadCell'\n\n  export default {\n    name: 'JVxeFileCell',\n    mixins: [JVxeCellMixins],\n    components: {JFilePop},\n    props: {},\n    data() {\n      return {\n        innerFile: null,\n        number:0,\n      }\n    },\n    computed: {\n      /** upload headers */\n      uploadHeaders() {\n        let {originColumn: col} = this\n        let headers = {}\n        if (col.token === true) {\n          headers['X-Access-Token'] = this.$ls.get(ACCESS_TOKEN)\n        }\n        return headers\n      },\n\n      /** 上传请求地址 */\n      uploadAction() {\n        if (!this.originColumn.action) {\n          return window._CONFIG['domianURL'] + '/sys/common/upload'\n        } else {\n          return this.originColumn.action\n        }\n      },\n\n      hasFile() {\n        return this.innerFile != null\n      },\n\n      ellipsisFileName() {\n        let length = 5\n        let file = this.innerFile\n        if (!file || !file.name) {\n          return ''\n        }\n        if (file.name.length > length) {\n          return file.name.substr(0, length) + '…'\n        }\n        return file.name\n      },\n\n      responseName() {\n        if (this.originColumn.responseName) {\n          return this.originColumn.responseName\n        } else {\n          return 'message'\n        }\n      },\n\n    },\n    watch: {\n      innerValue: {\n        immediate: true,\n        handler() {\n          if (this.innerValue) {\n            this.innerFile = this.innerValue\n          } else {\n            this.innerFile = null\n          }\n        },\n      },\n    },\n    methods: {\n\n      // 点击更多按钮\n      handleMoreOperation(originColumn) {\n        //update-begin-author:wangshuai date:20201021 for:LOWCOD-969 判断传过来的字段是否存在number，用于控制上传文件\n        if (originColumn.number) {\n          this.number = originColumn.number\n        } else {\n          this.number = 0\n        }\n        //update-end-author:wangshuai date:20201021 for:LOWCOD-969 判断传过来的字段是否存在number，用于控制上传文件\n        if(originColumn && originColumn.fieldExtendJson){\n          let json = JSON.parse(originColumn.fieldExtendJson);\n          this.number = json.uploadnum?json.uploadnum:0;\n        }\n        let path = ''\n        if (this.innerFile) {\n          path = this.innerFile.path\n        }\n        this.$refs.filePop.show('', path)\n      },\n\n      // 更多上传回调\n      handleFileSuccess(file) {\n        if (file) {\n          this.innerFile.path = file.path\n          this.handleChangeCommon(this.innerFile)\n        }\n      },\n\n      handleChangeUpload(info) {\n        let {originColumn: col} = this\n        let {file} = info\n        let value = {\n          name: file.name,\n          type: file.type,\n          size: file.size,\n          status: file.status,\n          percent: file.percent\n        }\n        if (file.response) {\n          value['responseName'] = file.response[this.responseName]\n        }\n        if (file.status === 'done') {\n          value['path'] = file.response[this.responseName]\n          this.handleChangeCommon(value)\n        } else if (file.status === 'error') {\n          value['message'] = file.response.message || '未知错误'\n        }\n        this.innerFile = value\n      },\n\n      handleClickDownloadFile() {\n        let {url, path} = this.innerFile || {}\n        if (!url || url.length === 0) {\n          if (path && path.length > 0) {\n            url = getFileAccessHttpUrl(path.split(',')[0])\n          }\n        }\n        if (url) {\n          window.open(url)\n        }\n      },\n\n      handleClickDeleteFile() {\n        this.handleChangeCommon(null)\n      },\n\n    },\n    // 【组件增强】注释详见：JVxeCellMixins.js\n    enhanced: {\n      switches: {visible: true},\n      getValue: value => JVxeUploadCell.enhanced.getValue(value),\n      setValue: value => JVxeUploadCell.enhanced.setValue(value),\n    }\n  }\n</script>\n\n<style scoped lang=\"less\">\n</style>\n"],"sourceRoot":"src/components/JVxeCells"}]}