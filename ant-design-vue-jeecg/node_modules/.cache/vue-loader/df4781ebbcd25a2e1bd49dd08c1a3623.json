{"remainingRequest":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\src\\extends\\FileMangement\\fileMangement.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\src\\extends\\FileMangement\\fileMangement.vue","mtime":1611914356000},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621061384845},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1621061377995},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621061384845},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1621061372054}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {downloadFile, getAction, postAction} from '@/api/manage';\n  export default {\n    props: {\n      uuId:{\n          type: String,\n          default: '',\n          required: false\n        },\n      fileType:{\n        type: String,\n        default: '',\n        required: false\n      },\n      projectId:{\n        type: String,\n        default: '',\n        required: false\n      },\n      moduleCode:{\n        type: String,\n        default: '',\n        required: false\n      },\n      isMultiple:{\n        type:Boolean,\n        required:false,\n        default: true\n      },\n    },\n      name: \"fileMangement\",\n      data(){\n        return {\n          fileList:[],\n          url: {\n            queryByBusinessId:\"/system/sysFile/queryByBusinessId\",\n          }\n        }\n      },\n    created() {\n      const _this = this;\n      const uuId = this.uuId;\n      this.intFile();\n    },\n    watch:{\n      uuId(newVal,oldVal){\n        this.uuId = newVal;\n        this.intFile();\n      }\n    },\n      methods: {\n        //上传文件\n        upload (params){return postAction(\"/system/sysFile/upload\",params)},\n        download (params){return getAction(\"/system/sysFile/download\",params)},\n        deleteFile (params){return getAction(\"/system/sysFile/delete\",params)},\n         intFile(){\n           let _this = this;\n           //修改数据回显\n           const uuId = this.uuId;\n           this.getAction(this.url.queryByBusinessId,{\n             businessId:uuId,\n           }).then((res)=>{\n             if(res.code == 200){\n               let sysFiles = res.result;\n               if(sysFiles != null && sysFiles.length >0){\n                 for(let i = 0;i<sysFiles.length; i++){\n                   let file = sysFiles[i];\n                   sysFiles[i].uid = sysFiles[i].id;\n                   sysFiles[i].name = sysFiles[i].fileName;\n                   sysFiles[i].status = 'done';\n                 }\n               }else{\n                 sysFiles = []\n               }\n               _this.fileList = sysFiles;\n               console.log('_this.$emit(\"afterIntFiles\",_this.fileList)')\n               _this.$emit(\"afterIntFiles\",_this.fileList)\n             }\n            });\n         },\n        /*上传文件 */\n        changeFile(info){\n          const _this = this;\n          if (info.file.status === 'uploading') {\n            let fileId = this.fileId;\n            let fileList = [...info.fileList];\n            fileList = fileList.map(file => {\n              if (file.response) {\n                file.url = file.response.url;\n              }\n              return file;\n            });\n            this.fileList = fileList;\n            console.log('this.fileList',this.fileList);\n            _this.$emit(\"changeFile\",_this.fileList,info.file.status)\n          }\n          if(info.file.status === \"removed\"){\n            let fileId = info.file.id;\n            const formData = {id:fileId}\n            this.deleteFile(formData);\n            this.fileList = info.fileList;\n            _this.$emit(\"changeFile\",_this.fileList,info.file.status)\n          }\n          if (info.file.status === 'done') {\n            this.$message.success(`${info.file.name} 上传成功`);\n          } else if (info.file.status === 'error') {\n            this.$message.error(`${info.file.name} 上传失败.`);\n          }\n        },\n        customRequest(data){ // 上传提交\n          const formData = new FormData()\n          formData.append('file', data.file)\n          formData.append('businessId',this.uuId)\n          formData.append('fileType',this.fileType)\n          formData.append('projectId',this.projectId?this.projectId:0)\n          formData.append('moduleCode',this.moduleCode)\n          this.saveFile(formData)\n        },\n        saveFile (formData) {\n          const _this = this;\n          _this.upload(formData).then((res) => {\n            console.log(\"--->\");\n            console.log(res);\n            if(res.code == 200){\n              _this.intFile();\n            }else{\n              const fileList = _this.fileList;\n              const fileLast = fileList[fileList.length-1];\n              const fileId  = res.result.ids[0];\n              fileList[fileList.length-1].status = 'error';\n            }\n          }).finally(() => {\n            this.loading = false\n          })\n        },\n        downloadFile(formData){\n          formData = {id:formData.id}\n          this.download(formData);\n        },\n        previewFile(formData){\n          let data = {id:formData.id}\n          downloadFile('/system/sysFile/download',formData.name,data);\n        },\n        removeFile(file){\n          console.log(\"file\",file);\n        },\n        beforeUpload(file) {\n          if (this.fileType==='img'){\n            const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png';\n            if (!isJpgOrPng) {\n              this.$message.error('请选择图片文件上传!');\n            }\n            const isLt2M = file.size / 1024 / 1024 < 2;\n            if (!isLt2M) {\n              this.$message.error('上传的文件请小于 2MB!');\n            }\n            return isJpgOrPng && isLt2M;\n          }\n          return true;\n        },\n      }\n  }\n",{"version":3,"sources":["fileMangement.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAyBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"fileMangement.vue","sourceRoot":"src/extends/FileMangement","sourcesContent":["<template>\n  <a-upload-dragger\n    :fileList=\"fileList\"\n    :multiple=\"isMultiple\"\n    @change=\"changeFile\"\n    class=\"upload-list-inline\"\n    :customRequest=\"customRequest\"\n    @download=\"downloadFile\"\n    @preview=\"previewFile\"\n    @remove=\"removeFile\"\n    :before-upload=\"beforeUpload\"\n  >\n    <p class=\"ant-upload-drag-icon\">\n      <a-icon type=\"inbox\" />\n    </p>\n    <p class=\"ant-upload-text\">\n      单击或拖动文件到此区域以上载\n    </p>\n    <p v-if=\"isMultiple\" class=\"ant-upload-hint\">\n      支持单次或批量上传。\n    </p>\n  </a-upload-dragger>\n</template>\n\n<script>\n  import {downloadFile, getAction, postAction} from '@/api/manage';\n    export default {\n      props: {\n        uuId:{\n            type: String,\n            default: '',\n            required: false\n          },\n        fileType:{\n          type: String,\n          default: '',\n          required: false\n        },\n        projectId:{\n          type: String,\n          default: '',\n          required: false\n        },\n        moduleCode:{\n          type: String,\n          default: '',\n          required: false\n        },\n        isMultiple:{\n          type:Boolean,\n          required:false,\n          default: true\n        },\n      },\n        name: \"fileMangement\",\n        data(){\n          return {\n            fileList:[],\n            url: {\n              queryByBusinessId:\"/system/sysFile/queryByBusinessId\",\n            }\n          }\n        },\n      created() {\n        const _this = this;\n        const uuId = this.uuId;\n        this.intFile();\n      },\n      watch:{\n        uuId(newVal,oldVal){\n          this.uuId = newVal;\n          this.intFile();\n        }\n      },\n        methods: {\n          //上传文件\n          upload (params){return postAction(\"/system/sysFile/upload\",params)},\n          download (params){return getAction(\"/system/sysFile/download\",params)},\n          deleteFile (params){return getAction(\"/system/sysFile/delete\",params)},\n           intFile(){\n             let _this = this;\n             //修改数据回显\n             const uuId = this.uuId;\n             this.getAction(this.url.queryByBusinessId,{\n               businessId:uuId,\n             }).then((res)=>{\n               if(res.code == 200){\n                 let sysFiles = res.result;\n                 if(sysFiles != null && sysFiles.length >0){\n                   for(let i = 0;i<sysFiles.length; i++){\n                     let file = sysFiles[i];\n                     sysFiles[i].uid = sysFiles[i].id;\n                     sysFiles[i].name = sysFiles[i].fileName;\n                     sysFiles[i].status = 'done';\n                   }\n                 }else{\n                   sysFiles = []\n                 }\n                 _this.fileList = sysFiles;\n                 console.log('_this.$emit(\"afterIntFiles\",_this.fileList)')\n                 _this.$emit(\"afterIntFiles\",_this.fileList)\n               }\n              });\n           },\n          /*上传文件 */\n          changeFile(info){\n            const _this = this;\n            if (info.file.status === 'uploading') {\n              let fileId = this.fileId;\n              let fileList = [...info.fileList];\n              fileList = fileList.map(file => {\n                if (file.response) {\n                  file.url = file.response.url;\n                }\n                return file;\n              });\n              this.fileList = fileList;\n              console.log('this.fileList',this.fileList);\n              _this.$emit(\"changeFile\",_this.fileList,info.file.status)\n            }\n            if(info.file.status === \"removed\"){\n              let fileId = info.file.id;\n              const formData = {id:fileId}\n              this.deleteFile(formData);\n              this.fileList = info.fileList;\n              _this.$emit(\"changeFile\",_this.fileList,info.file.status)\n            }\n            if (info.file.status === 'done') {\n              this.$message.success(`${info.file.name} 上传成功`);\n            } else if (info.file.status === 'error') {\n              this.$message.error(`${info.file.name} 上传失败.`);\n            }\n          },\n          customRequest(data){ // 上传提交\n            const formData = new FormData()\n            formData.append('file', data.file)\n            formData.append('businessId',this.uuId)\n            formData.append('fileType',this.fileType)\n            formData.append('projectId',this.projectId?this.projectId:0)\n            formData.append('moduleCode',this.moduleCode)\n            this.saveFile(formData)\n          },\n          saveFile (formData) {\n            const _this = this;\n            _this.upload(formData).then((res) => {\n              console.log(\"--->\");\n              console.log(res);\n              if(res.code == 200){\n                _this.intFile();\n              }else{\n                const fileList = _this.fileList;\n                const fileLast = fileList[fileList.length-1];\n                const fileId  = res.result.ids[0];\n                fileList[fileList.length-1].status = 'error';\n              }\n            }).finally(() => {\n              this.loading = false\n            })\n          },\n          downloadFile(formData){\n            formData = {id:formData.id}\n            this.download(formData);\n          },\n          previewFile(formData){\n            let data = {id:formData.id}\n            downloadFile('/system/sysFile/download',formData.name,data);\n          },\n          removeFile(file){\n            console.log(\"file\",file);\n          },\n          beforeUpload(file) {\n            if (this.fileType==='img'){\n              const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png';\n              if (!isJpgOrPng) {\n                this.$message.error('请选择图片文件上传!');\n              }\n              const isLt2M = file.size / 1024 / 1024 < 2;\n              if (!isLt2M) {\n                this.$message.error('上传的文件请小于 2MB!');\n              }\n              return isJpgOrPng && isLt2M;\n            }\n            return true;\n          },\n        }\n    }\n</script>\n\n<style scoped>\n\n</style>"]}]}