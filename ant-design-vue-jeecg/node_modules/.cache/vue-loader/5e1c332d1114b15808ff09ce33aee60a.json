{"remainingRequest":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\src\\views\\activiti\\ProcessModelList.vue?vue&type=style&index=0&id=34ac6a3e&scoped=true&lang=css&","dependencies":[{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\src\\views\\activiti\\ProcessModelList.vue","mtime":1621994095276},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\css-loader\\index.js","mtime":1620887942039},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1621061372054},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\postcss-loader\\src\\index.js","mtime":1617935823297},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621061384845},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1621061372054}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@import '~@assets/less/common.less';\n.nodespan{\n  color: #999;\n}\n.ant-checkbox-wrapper + .ant-checkbox-wrapper{\n  margin-left: 0;\n  margin-right: 8px;\n}\n",{"version":3,"sources":["ProcessModelList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyuBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ProcessModelList.vue","sourceRoot":"src/views/activiti","sourcesContent":["<template>\r\n  <a-card :bordered=\"false\">\r\n    <!-- 查询区域 -->\r\n    <div class=\"table-page-search-wrapper\">\r\n      <a-form layout=\"inline\" @keyup.enter.native=\"searchQuery\">\r\n        <a-row :gutter=\"24\">\r\n\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"流程名称\">\r\n              <a-input placeholder=\"请输入搜索关键词\" v-model=\"queryParam.lcmc\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"流程标识\">\r\n              <a-input placeholder=\"请输入搜索关键词\" v-model=\"queryParam.lckey\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :md=\"6\" :sm=\"8\">\r\n            <a-form-item label=\"是否最新\">\r\n              <a-switch checkedChildren=\"是\" unCheckedChildren=\"否\" defaultChecked v-model=\"queryParam.zx\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <!--<a-col :md=\"6\" :sm=\"10\">\r\n            <a-form-item label=\"创建时间\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\">\r\n              <a-range-picker\r\n                style=\"width: 210px\"\r\n                v-model=\"queryParam.createTimeRange\"\r\n                format=\"YYYY-MM-DD\"\r\n                :placeholder=\"['开始时间', '结束时间']\"\r\n                @change=\"onDateChange\"\r\n                @ok=\"onDateOk\"\r\n              />\r\n            </a-form-item>\r\n          </a-col>-->\r\n\r\n          <span style=\"float: left;overflow: hidden;\" class=\"table-page-search-submitButtons\">\r\n            <a-col :md=\"6\" :sm=\"12\" >\r\n                <a-button type=\"primary\"  style=\"left: 10px\" @click=\"searchQuery\" icon=\"search\">查询</a-button>\r\n                <a-button type=\"primary\"  @click=\"searchReset\" icon=\"reload\" style=\"margin-left: 8px;left: 10px\">重置</a-button>\r\n            </a-col>\r\n          </span>\r\n          <span style=\"float: right;overflow: hidden;\" class=\"table-page-search-submitButtons\">\r\n            <a-col :md=\"12\" :sm=\"12\" >\r\n<!--                <a-button type=\"primary\"  style=\"left: 10px\" @click=\"createObj.visible=true\" icon=\"search\">创建流程模型</a-button>-->\r\n            </a-col>\r\n          </span>\r\n\r\n        </a-row>\r\n      </a-form>\r\n    </div>\r\n\r\n    <!-- table区域-begin -->\r\n    <a-table :scroll=\"{x:2200,y:500}\" bordered\r\n      ref=\"table\"\r\n      size=\"middle\"\r\n      rowKey=\"id\"\r\n      :dataSource=\"dataSource\"\r\n      :pagination=\"ipagination\"\r\n      :loading=\"loading\"\r\n      @change=\"handleTableChange\">\r\n\r\n      <a-table-column title=\"#\" :width=\"50\" fixed='left' key=\"a\">\r\n        <template slot-scope=\"t,r,i\" >\r\n          <span> {{i+1}} </span>\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column title=\"流程名称\" dataIndex=\"name\" :width=\"200\" align=\"center\" fixed='left'>\r\n        <template slot-scope=\"t,r,i\">\r\n          <span> {{t}} </span>\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column title=\"流程标识\" dataIndex=\"processKey\" :width=\"200\" align=\"center\">\r\n        <template slot-scope=\"t,r,i\">\r\n          <span> {{t}} </span>\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column title=\"版本\" dataIndex=\"version\" key=\"asa\" :width=\"100\" align=\"center\"\r\n                       :sorter=\"(a, b) => a.version - b.version\">\r\n        <template slot-scope=\"t,r,i\">\r\n          <span> v.{{t}} </span>\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column title=\"所属分类\" dataIndex=\"categoryId\" :width=\"200\" align=\"center\" key=\"categoryId_\"\r\n                      :filters = \"lcTypeF\" @filter=\"filter_categoryId\">\r\n        <template slot-scope=\"t,r,i\">\r\n          <span> {{filterDictText(dictOptions, t)}} </span>\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column title=\"流程图片\" dataIndex=\"diagramName\" :width=\"200\" align=\"center\">\r\n        <template slot-scope=\"t,r,i\">\r\n          <span @click=\"showResource(r)\" style=\"color: blue;cursor: pointer;\">{{t}}</span>\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column title=\"表单路由\" dataIndex=\"routeName\" :width=\"200\" align=\"center\">\r\n        <template slot-scope=\"t,r,i\">\r\n          <span @click=\"viewForm(t)\" style=\"color: blue;cursor: pointer;\"> {{getFormComponent(t).text}} </span>\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column title=\"状态\" dataIndex=\"status\" :width=\"200\" align=\"center\">\r\n        <template slot-scope=\"t,r,i\">\r\n          <span v-if=\"t==1\" style=\"color: #00A0E9;\"> 已启用 </span>\r\n          <span v-if=\"t!=1\" style=\"color: #999;\"> 未启用 </span>\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column title=\"备注说明\" dataIndex=\"description\" :width=\"200\" align=\"center\">\r\n        <template slot-scope=\"t,r,i\">\r\n          <j-ellipsis :value=\"t\" :length=\"10\"/>\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column title=\"部署时间\" dataIndex=\"createTime\" :width=\"200\" align=\"center\">\r\n        <template slot-scope=\"t,r,i\">\r\n          <span> {{t}} </span>\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column title=\"更新时间\" dataIndex=\"updateTime\" :width=\"200\" align=\"center\">\r\n        <template slot-scope=\"t,r,i\">\r\n          <span> {{t}} </span>\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column title=\"操作\" dataIndex=\"\"  align=\"center\" :width=\"250\" fixed='right'>\r\n        <template slot-scope=\"t,r,i\">\r\n\r\n          <a href=\"javascript:void(0);\" v-if=\"r.status!=1\" @click=\"editStatus(1,r)\" style=\"color: rgb(144,96,255);\">启用</a>\r\n          <a href=\"javascript:void(0);\" v-if=\"r.status==1\" @click=\"editStatus(0,r)\" style=\"color: #cb892d\">禁用</a>\r\n          <a-divider type=\"vertical\" />\r\n          <a href=\"javascript:void(0);\" @click=\"getNodeData(r)\" >节点设置</a>\r\n          <a-divider type=\"vertical\" />\r\n          <a href=\"javascript:void(0);\" @click=\"convertToModel(r)\" >复制为模型</a>\r\n          <br>\r\n          <a href=\"javascript:void(0);\"  @click=\"edit(r)\">编辑</a> <a-divider type=\"vertical\" />\r\n          <a href=\"javascript:void(0);\" style=\"color: red;\" @click=\"remove(r)\">删除</a>\r\n\r\n\r\n        </template>\r\n      </a-table-column>\r\n    </a-table>\r\n    <!-- table区域-end -->\r\n    <!--编辑-->\r\n    <a-modal  width=\"900px\"\r\n      :confirmLoading=\"confirmLoading\"\r\n      title=\"编辑流程\"\r\n      :visible=\"editObj.visible\"\r\n      @ok=\"editObjOk\"\r\n      @cancel=\"editObj.visible = false\"\r\n    >\r\n      <a-form :form=\"editForm\" v-if=\"editObj.visible\">\r\n        <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"流程分类\" >\r\n          <component :is=\"LcDict\" :trigger-change=\"true\" v-decorator=\"[ 'categoryId', {initialValue:editObj.categoryId, rules: [{ required: true, message: '不能为空' }] },]\"\r\n                       placeholder=\"请选择流程分类\" dictCode=\"bpm_process_type\" ></component>\r\n        </a-form-item>\r\n       <!-- <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"流程类目(app使用)\" >\r\n          <j-tree-dict placeholder=\"请选择流程类目\" parentCode=\"A01\"\r\n                       :trigger-change=\"true\" v-decorator=\"[ 'typeId', {initialValue:editObj.typeId, rules: [{ required: true, message: '不能为空' }] },]\"\r\n          >\r\n          </j-tree-dict>\r\n        </a-form-item>-->\r\n        <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"关联表单\" >\r\n          <a-select @change=\"change_routeName\" placeholder=\"请选择关联表单\" :trigger-change=\"true\" v-decorator=\"[ 'routeName', {initialValue:editObj.routeName, rules: [{ required: true, message: '不能为空' }] },]\">\r\n            <a-select-option value=\"\">请选择</a-select-option>\r\n            <a-select-option v-for=\"(item, i) in allFormComponent\" :key=\"item.routeName\" :value=\"item.routeName\">\r\n              <span style=\"display: inline-block;width: 100%\" :title=\" item.text\">\r\n                {{ item.text}}\r\n              </span>\r\n            </a-select-option>\r\n          </a-select>\r\n          <a href=\"javascrip:void(0)\" @click=\"viewForm()\">预览表单</a>\r\n        </a-form-item>\r\n\r\n<!--        <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"关联打印报表\" >\r\n          <a-select @change=\"change_routeName\" placeholder=\"请选择关联报表\" :trigger-change=\"true\" v-decorator=\"[ 'reportModelId', {initialValue:editObj.reportModelId, rules: [{ required: true, message: '不能为空' }] },]\">\r\n            <a-select-option value=\"\">请选择</a-select-option>\r\n            <a-select-option v-for=\"(item, i) in reportList\" :key=\"item.id\" :value=\"item.id\">\r\n              <span style=\"display: inline-block;width: 100%\" :title=\" item.name\">\r\n                {{ item.name}}\r\n              </span>\r\n            </a-select-option>\r\n          </a-select>\r\n          &lt;!&ndash;<a href=\"javascrip:void(0)\" @click=\"viewForm()\">预览表单</a>&ndash;&gt;\r\n        </a-form-item>-->\r\n\r\n        <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"角色授权\" >\r\n          <j-select-role placeholder=\"不选择则所有人可用\" v-decorator=\"[ 'roles', {initialValue:editObj.roles, rules: []}]\"/>\r\n        </a-form-item>\r\n        <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"排序\" >\r\n          <a-input-number  v-decorator=\"[ 'sort', {initialValue:editObj.sort, rules: []}]\" placeholder=\"排序\"/>\r\n        </a-form-item>\r\n        <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"备注描述\" >\r\n          <a-textarea  v-decorator=\"[ 'description', {initialValue:editObj.description, rules: []}]\" placeholder=\"备注描述\" :autoSize=\"{ minRows: 3, maxRows: 5 }\" />\r\n        </a-form-item>\r\n      </a-form>\r\n    </a-modal>\r\n    <!--节点设置-->\r\n    <a-modal\r\n      title=\"编辑流程节点\" width=\"900px\" :maskClosable=\"false\"\r\n      :confirmLoading=\"confirmLoading\"\r\n      :visible=\"showProcessNodeEdit\"\r\n      :footer=\"null\"\r\n      @cancel=\"closeNode\"\r\n    >\r\n      <a-row>\r\n        <a-col :md=\"4\" :sm=\"4\" style=\"border-right: 1px solid #999\">\r\n<!--          选择流程节点-->\r\n          <a-steps direction=\"vertical\" :current=\"current\" size=\"small\">\r\n            <template  v-for=\"item,i in nodeList\">\r\n              <a-step style=\"cursor: pointer;\" :title=\"item.title\"\r\n                      :description=\"item.description\" :status=\"i==current?'process':'wait'\"\r\n                      @click=\"change_steps(item,i)\"/>\r\n            </template>\r\n          </a-steps>\r\n        </a-col>\r\n        <a-col :md=\"20\" :sm=\"20\">\r\n          <a-alert message=\"温馨提示：若流程运行至未分配审批人员的审批节点时，流程将自动中断取消！\" banner />\r\n          <span></span>\r\n          <a-form :form=\"nodeForm\" v-if=\"showProcessNodeEdit\">\r\n            <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"节点名称\" >\r\n              <span class=\"nodespan\">{{editNode.title}}</span>\r\n            </a-form-item>\r\n            <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"节点类型\" >\r\n              <span class=\"nodespan\">{{dictNodeType[editNode.type]}}</span>\r\n            </a-form-item>\r\n            <a-alert type=\"info\" message=\"每个节点设置，如有修改都请保存一次，跳转节点后数据不会自动保存！\" banner />\r\n            <br/>\r\n            <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\"  label=\"审批人员\" v-show=\"editNode.type==1\">\r\n              <a-checkbox-group @change=\"spryType\" v-model=\"spryTypes\" >\r\n                  <!-- 0角色 1用户 2部门 3发起人 4发起人的部门负责人-->\r\n                <a-checkbox value=\"0\"> 根据角色选择 </a-checkbox>\r\n                <a-checkbox value=\"1\"> 直接选择人员 </a-checkbox>\r\n                <a-checkbox value=\"2\"> 部门 </a-checkbox>\r\n                <a-checkbox value=\"5\"> 部门负责人 </a-checkbox>\r\n                <a-checkbox value=\"3\">\r\n                  发起人\r\n                  <a-tooltip placement=\"topLeft\" title=\"自动获取发起人\">\r\n                    <a-icon type=\"exclamation-circle\" />\r\n                  </a-tooltip>\r\n                </a-checkbox>\r\n                <a-checkbox value=\"4\">\r\n                  发起人的部门负责人\r\n                  <a-tooltip placement=\"topLeft\" title=\"自动获取发起人所在部门的负责人，即其上级领导。（如果其本身就是部门负责人，则指向发起人自己。）\">\r\n                    <a-icon type=\"exclamation-circle\" />\r\n                  </a-tooltip>\r\n                </a-checkbox>\r\n                <a-checkbox value=\"6\">\r\n                  表单变量\r\n                  <a-tooltip placement=\"topLeft\" title=\"填写与表单中相对应的变量，role:角色，user:人员：dept:部门：deptManage:部门负责人; 例如：variable:role,variable2:user;\">\r\n                    <a-icon type=\"exclamation-circle\" />\r\n                  </a-tooltip>\r\n                </a-checkbox>\r\n\r\n              </a-checkbox-group>\r\n            </a-form-item>\r\n            <!--            0角色 1用户 2部门 3发起人 4发起人的部门负责人-->\r\n            <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"选择角色\" v-if=\"spryTypes.indexOf('0')>-1\" >\r\n              <j-select-role  v-model=\"spry.roleIds\"/>\r\n            </a-form-item>\r\n            <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"选择人员\" v-if=\"spryTypes.indexOf('1')>-1\" >\r\n              <!--  通过部门选择用户控件 -->\r\n              <j-select-user-by-dep v-model=\"spry.userIds\" :multi=\"true\"></j-select-user-by-dep>\r\n            </a-form-item>\r\n            <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"选择部门\" v-if=\"spryTypes.indexOf('2')>-1\" >\r\n              <j-select-depart v-model=\"spry.departmentIds\" :multi=\"true\"></j-select-depart>\r\n            </a-form-item>\r\n            <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"选择部门负责人\" v-if=\"spryTypes.indexOf('5')>-1\" >\r\n              <j-select-depart v-model=\"spry.departmentManageIds\" :multi=\"true\"></j-select-depart>\r\n            </a-form-item>\r\n            <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"输入表单变量\" v-if=\"spryTypes.indexOf('6')>-1\" >\r\n              <a-input v-model=\"spry.formVariables\" :multi=\"true\"></a-input>\r\n            </a-form-item>\r\n            <!--btn-->\r\n            <a-form-item :wrapper-col=\"{ span: 12, offset: 5 }\">\r\n              <a-button @click=\"sprySubmit\" type=\"primary\" html-type=\"submit\" :disabled=\"editNode.type==0||editNode.type==2||confirmLoading\">\r\n                提交并保存\r\n              </a-button>\r\n\r\n              <a-button @click=\"closeNode\" style=\"margin-left: 10px\">\r\n                关闭\r\n              </a-button>\r\n            </a-form-item>\r\n          </a-form>\r\n        </a-col>\r\n      </a-row>\r\n    </a-modal>\r\n    <!--查看图片-->\r\n    <a-modal\r\n      :title=\"viewTitle\" width=\"90%\"\r\n      :visible=\"viewImage\" :footer=\"null\"\r\n      @cancel=\"viewImage = false\"\r\n    >\r\n      <div style=\"min-height: 400px\">\r\n        <img :src=\"diagramUrl\" :alt=\"viewTitle\">\r\n      </div>\r\n    </a-modal>\r\n    <!--流程表单 预览-->\r\n    <a-modal  :title=\"lcModa.title\" v-model=\"lcModa.visible\" :footer=\"null\" :maskClosable=\"false\" width=\"80%\">\r\n      <component :is=\"lcModa.formComponent\" :disabled=\"true\"></component>\r\n    </a-modal>\r\n  </a-card>\r\n\r\n</template>\r\n\r\n<script>\r\n  import pick from \"lodash.pick\";\r\n  import { filterObj } from '@/utils/util';\r\n  import { JeecgListMixin } from '@/mixins/JeecgListMixin'\r\n  import { activitiMixin } from '@/views/activiti/mixins/activitiMixin'\r\n  import JEllipsis from '@/components/jeecg/JEllipsis'\r\n  import { deleteAction, getAction,downFile } from '@/api/manage'\r\n  import JTreeSelect from '@/components/jeecg/JTreeSelect'\r\n  import JTreeDict from '@/components/jeecg/JTreeDict'\r\n  import {initDictOptions, filterDictText} from '@/components/dict/JDictSelectUtil'\r\n  import JSelectUserByDep from '@/components/jeecgbiz/JSelectUserByDep'\r\n  import JSelectRole from '@/components/jeecgbiz/JSelectRole'\r\n  import JSelectDepart from '@/components/jeecgbiz/JSelectDepart'\r\n\r\n  export default {\r\n    name: \"ProcessModelList\",\r\n    mixins:[activitiMixin,JeecgListMixin],\r\n    components: {\r\n      JEllipsis,JSelectUserByDep,JSelectRole,JSelectDepart\r\n      ,JTreeSelect,JTreeDict\r\n    },\r\n    created(){\r\n      // this.initReportList();\r\n    },\r\n    data () {\r\n      return {\r\n        reportList:[],\r\n        viewImage:false,\r\n        viewTitle:\"\",\r\n        diagramUrl:\"\",\r\n        /*编辑流程*/\r\n        editObj:{\r\n          visible: false,\r\n        },\r\n        editForm: this.$form.createForm(this),\r\n\r\n        description: '已部署模型',\r\n        // 查询条件\r\n        queryParam: {\r\n          createTimeRange:[],\r\n          keyWord:'',\r\n          zx:true\r\n        },\r\n        tabKey: \"1\",\r\n        // 表头\r\n        labelCol: {\r\n          xs: { span: 4 },\r\n          sm: { span: 4 },\r\n        },\r\n        wrapperCol: {\r\n          xs: { span: 20 },\r\n          sm: { span: 20 },\r\n        },\r\n        confirmLoading:false,\r\n        current:0,\r\n        nodeForm: this.$form.createForm(this),\r\n        dictOptions:[],\r\n        nodeList:[],\r\n        editNode:{},\r\n        showProcessNodeEdit:false,\r\n        dictNodeType:{\r\n          '0':'开始节点',\r\n          '1':'审批节点',\r\n          '2':'结束节点',\r\n        },\r\n        spryTypes:[],\r\n        url: {\r\n          list: \"/activiti_process/listData\",\r\n          img: \"/activiti/models/export\",\r\n          updateStatus: \"/activiti_process/updateStatus\",\r\n          delByIds: \"/activiti_process/delByIds\",\r\n          convertToModel: \"/activiti_process/convertToModel\",\r\n          updateInfo: \"/activiti_process/updateInfo\",\r\n          getProcessNode: \"/activiti_process/getProcessNode\",\r\n          editNodeUser: \"/activiti_process/editNodeUser\",\r\n        },\r\n        spry:{\r\n          //选中的用户\r\n          userIds:'',\r\n          roleIds:'',\r\n          departmentIds:'',\r\n          departmentManageIds:'',\r\n          formVariables:'',\r\n          chooseSponsor:false,\r\n          chooseDepHeader:false,\r\n        },\r\n        lcModa: {\r\n          title:'流程表单预览',\r\n          visible:false,\r\n          formComponent : null\r\n        },\r\n        lcTypeF:[],\r\n        dataList: [],\r\n        updateRow: {}\r\n      }\r\n    },\r\n    computed:{\r\n      //可行性测试，根据文件路径动态加载组件\r\n      LcDict:function(){\r\n        var myComponent =() => import(`@/components/dict/JDictSelectTag`);\r\n        return myComponent;\r\n      },\r\n    },\r\n    methods: {\r\n      /*initReportList(){\r\n        // 加载reportList\r\n        getAction('/report/reportModel/all',{}).then(res=>{\r\n          if(res.success){\r\n            this.reportList = res.result;\r\n          }\r\n        }).catch(()=>{\r\n          console.log(\"字典加载失败\");\r\n        });\r\n      },*/\r\n      initDictConfig() {\r\n        //初始化字典 - 流程分类\r\n        initDictOptions('bpm_process_type').then((res) => {\r\n          if (res.success) {\r\n            var lcTypes = [];\r\n            this.dictOptions = res.result||[];\r\n            for (const dict of this.dictOptions) {\r\n              lcTypes.push({text:dict.text,value:dict.value})\r\n            }\r\n            this.lcTypeF = lcTypes;\r\n            console.log(lcTypes)\r\n          }\r\n        });\r\n      },\r\n      filterDictText(dictOptions, text) {\r\n        if (dictOptions instanceof Array) {\r\n          for (let dictItem of dictOptions) {\r\n            if (text === dictItem.value) {\r\n              return dictItem.text\r\n            }\r\n          }\r\n        }\r\n        return text\r\n      },\r\n      closeNode() {\r\n        this.showProcessNodeEdit = false,\r\n        this.current=0,\r\n        this.spryTypes=[],\r\n        this.spry={}\r\n      },\r\n      /*编辑流程节点*/\r\n\r\n      change_steps(node,index){\r\n        this.spryTypes = [];\r\n        console.log('onChange:', node);\r\n        this.current = index;\r\n        this.editNode = node;\r\n        /* 0角色 1用户 2部门 3发起人 4发起人的部门负责人 5部门的部门负责人*/\r\n        this.spry.chooseDepHeader = node.chooseDepHeader||false;\r\n        if (this.spry.chooseDepHeader) this.spryTypes.push('4') ;\r\n        this.spry.chooseSponsor = node.chooseSponsor||false;\r\n        if (this.spry.chooseSponsor) this.spryTypes.push('3') ;\r\n        var userIds = [];\r\n        for (const user of node.users||[]) {\r\n          userIds.push(user.username);\r\n        }\r\n        this.spry.userIds = userIds.join(\",\");\r\n        if (userIds.length>0) this.spryTypes.push('1') ;\r\n        var roleIds = []\r\n        for (const role of node.roles||[]) {\r\n          roleIds.push(role.roleCode)\r\n        }\r\n        this.spry.roleIds = roleIds.join(\",\")\r\n        if (roleIds.length>0) this.spryTypes.push('0') ;\r\n        var departmentIds = []\r\n        for (const department of node.departments||[]) {\r\n          departmentIds.push(department.id)\r\n        }\r\n        this.spry.departmentIds = departmentIds.join(\",\")\r\n        if (departmentIds.length>0) this.spryTypes.push('2') ;\r\n        var departmentManageIds = []\r\n        for (const departmentManage of node.departmentManages || []){\r\n          departmentManageIds.push(departmentManage.id);\r\n        }\r\n        this.spry.departmentManageIds = departmentManageIds.join(\",\")\r\n        if (departmentManageIds.length>0) this.spryTypes.push('5') ;\r\n        console.log(\"回显this.spry\",this.spry)\r\n\r\n        this.spry.formVariables = node.formVariables||'';\r\n        if (this.spry.formVariables) this.spryTypes.push('6');\r\n      },\r\n      spryType(types){\r\n        /* 0角色 1用户 2部门 3发起人 4发起人的部门负责人 5部门负责人*/\r\n        // this.spryTypes = types;\r\n        if (this.spryTypes.indexOf('0')==-1) this.spry.roleIds = '';\r\n        if (this.spryTypes.indexOf('1')==-1) this.spry.userIds = '';\r\n        if (this.spryTypes.indexOf('2')==-1) this.spry.departmentIds = '';\r\n        if (this.spryTypes.indexOf('5')==-1) this.spry.departmentManageIds = '';\r\n        if (this.spryTypes.indexOf('6')==-1) this.spry.formVariable = '';\r\n        //是否选中发起人\r\n        this.spry.chooseSponsor = this.spryTypes.indexOf('3')>-1 ;\r\n        //是否选中发起人的部门领导\r\n        this.spry.chooseDepHeader = this.spryTypes.indexOf('4')>-1 ;\r\n\r\n        console.log(\"this.spry\",this.spry)\r\n      },\r\n      sprySubmit() {\r\n        var _this = this;\r\n        if (this.spryTypes.length==0){\r\n          _this.$message.error(\"必须选择审批人！\");\r\n          return;\r\n        }\r\n        _this.confirmLoading = true;\r\n        this.spry.nodeId = this.editNode.id;\r\n        this.spry.procDefId = this.editNode.procDefId;\r\n        this.postFormAction(_this.url.editNodeUser,this.spry).then(res => {\r\n          if (res.success) {\r\n            _this.$message.success(\"操作成功\");\r\n            /*保存成功后回显数据*/\r\n            _this.getNodeData(_this.updateRow);\r\n          }else {\r\n            _this.$message.error(res.message);\r\n          }\r\n        }).finally(() => _this.confirmLoading = false);\r\n      },\r\n      /*节点设置*/\r\n      getNodeData(row){\r\n        let _this = this;\r\n        _this.updateRow = row;\r\n        _this.postFormAction(_this.url.getProcessNode,{\r\n          id:row.id\r\n        }).then(res => {\r\n          if (res.success) {\r\n            // 转换null为\"\"\r\n            _this.nodeList = res.result||[];\r\n            console.log(\"_this.nodeList\",_this.nodeList);\r\n            if (_this.nodeList.length>0){\r\n              _this.editNode = _this.nodeList[_this.current];\r\n              console.log(_this.current,_this.editNode)\r\n              _this.showProcessNodeEdit = true;\r\n            }\r\n          }else {\r\n            _this.$message.error(res.message);\r\n          }\r\n        });\r\n      },\r\n      /*编辑流程信息*/\r\n      edit(row){\r\n        this.editObj = Object.assign(this.editObj, row)\r\n        this.editObj.visible = true;\r\n      },\r\n      editObjOk(){\r\n        var _this = this;\r\n        this.editForm.validateFields((err, values) => {\r\n          if (!err) {\r\n            let formData = Object.assign(this.editObj, values)\r\n            console.log(\"formData\",formData)\r\n            this.confirmLoading = true;\r\n            this.postFormAction(this.url.updateInfo,formData).then(res => {\r\n              if (res.success) {\r\n                _this.$message.success(\"操作成功\");\r\n                _this.loadData();\r\n                _this.editObj.visible = false;\r\n              }else {\r\n                _this.$message.error(res.message);\r\n              }\r\n            }).finally(() => _this.confirmLoading = false);;\r\n          }\r\n        })\r\n      },\r\n      change_routeName(){\r\n        this.$nextTick(()=>{\r\n          let routeName = this.editForm.getFieldValue('routeName');\r\n          console.log(\"routeName\",routeName)\r\n          var route = this.getFormComponent(routeName);\r\n          this.editObj.businessTable = route.businessTable;\r\n          this.editObj.routeName = route.routeName;\r\n          console.log(\"this.editObj\",this.editObj)\r\n        })\r\n      },\r\n      viewForm(routeName) {\r\n        if (!routeName) routeName = this.editObj.routeName;\r\n        if (!routeName) {\r\n          this.$message.warning(\r\n            \"请先选择表单！\"\r\n          );\r\n          return;\r\n        }\r\n        let formComponent = this.getFormComponent(routeName);\r\n        console.log(formComponent)\r\n        this.lcModa.formComponent = formComponent.component;\r\n        this.lcModa.title = '流程表单预览：'+formComponent.text;\r\n        this.lcModa.visible = true;\r\n      },\r\n      convertToModel(row){\r\n        let that = this;\r\n        this.$confirm({\r\n          title: \"确认转化\",\r\n          content: \"您确认要转化流程 \" + row.name + \" 为模型?\",\r\n          loading: true,\r\n          onOk: () => {\r\n            that.postFormAction(`${that.url.convertToModel}`,{id:row.id}).then(res => {\r\n              if (res.success) {\r\n                setTimeout(function() {\r\n                  that.$message.success(\"转化成功\");\r\n                }, 300);\r\n              }else {\r\n                that.$message.error(res.message);\r\n              }\r\n            });\r\n          }\r\n        });\r\n      },\r\n      remove(row) {\r\n        var _this = this;\r\n        _this.$confirm({\r\n          title: \"确认删除\",\r\n          content: \"您确认要删除流程 \" + row.name + \" ?\",\r\n          loading: true,\r\n          onOk: () => {\r\n            _this.postFormAction(_this.url.delByIds,{ids:row.id}).then(res => {\r\n              if (res.success) {\r\n                _this.$message.success(\"操作成功\");\r\n                _this.loadData();\r\n              }else {\r\n                _this.$message.error(res.message);\r\n              }\r\n            });\r\n          }\r\n        });\r\n      },\r\n      editStatus(status, row) {\r\n        var _this = this;\r\n        let operation = \"\";\r\n        if (status == 0) {\r\n          operation = \"不启用\";\r\n        } else {\r\n          operation = \"启用\";\r\n        }\r\n        this.$confirm({\r\n          title: \"确认\" + operation+\"?\",\r\n          content:  `您确认要${operation}流程${row.name}?`,\r\n          onOk() {\r\n            let params = {\r\n              status: status,\r\n              id: row.id\r\n            };\r\n            _this.postFormAction(_this.url.updateStatus,params).then(res => {\r\n              if (res.success) {\r\n                _this.$message.success(\"操作成功\");\r\n                _this.loadData();\r\n              }else {\r\n                _this.$message.error(res.message);\r\n              }\r\n            });\r\n          }\r\n          ,\r\n          onCancel() {},\r\n        });\r\n      },\r\n      /*查看流程图片*/\r\n      showResource(row) {\r\n          this.viewTitle = \"流程图片预览(\" + row.diagramName + \")\";\r\n          this.diagramUrl = `${window._CONFIG['domianURL']}${this.url.img}?id=${row.id}`;\r\n          this.viewImage = true;\r\n      },\r\n      /*删除模型*/\r\n      deletelc(y,row) {\r\n        console.log(y,row);\r\n        if (y){\r\n          getAction(this.url.delete+row.id).then((res) => {\r\n            if (res.success){\r\n              this.$message.success(res.message);\r\n            }else {\r\n              this.$message.error(res.message);\r\n            }\r\n            this.loadData();\r\n          });\r\n        }\r\n      },\r\n      handleTableChange(pagination, filters, sorter) {\r\n        //分页、排序、筛选变化时触发\r\n        //TODO 筛选\r\n        if (Object.keys(sorter).length > 0) {\r\n          this.isorter.column = sorter.field;\r\n          this.isorter.order = \"ascend\" == sorter.order ? \"asc\" : \"desc\"\r\n        }\r\n        this.ipagination = pagination;\r\n        console.log(pagination,filters,sorter)\r\n        /*if (Object.keys(filters).length>0&&this.dataList.length>0){\r\n          for (const filterField in filters) {\r\n            let fiterVals = filters[filterField]||[];\r\n\r\n          }\r\n        }*/\r\n        // this.loadData();\r\n      },\r\n      loadData(arg) {\r\n        if(!this.url.list){\r\n          this.$message.error(\"请设置url.list属性!\")\r\n          return\r\n        }\r\n        //加载数据 若传入参数1则加载第一页的内容\r\n        if (arg === 1) {\r\n          this.ipagination.current = 1;\r\n        }\r\n        var params = this.getQueryParams();//查询条件\r\n        this.loading = true;\r\n        getAction(this.url.list, params).then((res) => {\r\n          if (res.success) {\r\n            let records = res.result||[];\r\n            this.dataSource = records;\r\n            this.dataList = records;\r\n            this.ipagination.total = records.length;\r\n          }\r\n          if(res.code===510){\r\n            this.$message.warning(res.message)\r\n          }\r\n          this.loading = false;\r\n        })\r\n      },\r\n      getQueryParams(){\r\n        var param = Object.assign({}, this.queryParam,this.isorter);\r\n        delete param.createTimeRange; // 时间参数不传递后台\r\n        return filterObj(param);\r\n      },\r\n\r\n      // 重置\r\n      searchReset(){\r\n        var that = this;\r\n        var logType = that.queryParam.logType;\r\n        that.queryParam = {}; //清空查询区域参数\r\n        that.queryParam.logType = logType;\r\n        that.loadData(this.ipagination.current);\r\n      },\r\n      onDateChange: function (value, dateString) {\r\n        console.log(dateString[0],dateString[1]);\r\n        this.queryParam.createTime_begin=dateString[0];\r\n        this.queryParam.createTime_end=dateString[1];\r\n      },\r\n      onDateOk(value) {\r\n        console.log(value);\r\n      },\r\n\r\n      filter_categoryId(v,r) {\r\n        // console.log(v,r)\r\n        return r.categoryId == v;\r\n      }\r\n    }\r\n  }\r\n</script>\r\n<style scoped>\r\n  @import '~@assets/less/common.less';\r\n  .nodespan{\r\n    color: #999;\r\n  }\r\n  .ant-checkbox-wrapper + .ant-checkbox-wrapper{\r\n    margin-left: 0;\r\n    margin-right: 8px;\r\n  }\r\n</style>"]}]}