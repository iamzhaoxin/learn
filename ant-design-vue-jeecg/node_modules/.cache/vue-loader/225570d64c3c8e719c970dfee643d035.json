{"remainingRequest":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\src\\views\\user\\LoginSelectTenant.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\src\\views\\user\\LoginSelectTenant.vue","mtime":1611914356000},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621061384845},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1621061377995},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621061384845},{"path":"D:\\activiti\\project01\\jeecg-boot-activiti-master\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1621061372054}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport Vue from 'vue'\nimport { getAction,putAction } from '@/api/manage'\nimport { USER_INFO } from \"@/store/mutation-types\"\nimport store from './Login'\n\nexport default {\n  name: 'LoginSelectTenant',\n  data(){\n    return {\n      visible: false,\n      isMultiDepart:false,\n      departList:[],\n\n      isMultiTenant:false,\n      tenantList:[],\n\n      username:'',\n      orgCode:'',\n      tenant_id:'',\n\n      validate_status1: \"\",\n      validate_status2: \"\",\n    }\n  },\n  computed:{\n    title(){\n      if(this.isMultiDepart && this.isMultiTenant){\n        return '请选择租户和部门'\n      }else if(this.isMultiDepart && !this.isMultiTenant){\n        return '请选择部门'\n      }else if(!this.isMultiDepart && this.isMultiTenant){\n        return '请选择租户'\n      }\n    }\n  },\n  methods:{\n    clear(){\n      this.departList = []\n      this.tenantList = []\n      this.visible=false\n      this.validate_status1=''\n      this.validate_status2=''\n    },\n    bizDepart(loginResult){\n      let multi_depart = loginResult.multi_depart\n      //0:无部门 1:一个部门 2:多个部门\n      if(multi_depart==0){\n        this.$notification.warn({\n          message: '提示',\n          description: `您尚未归属部门,请确认账号信息`,\n          duration:3\n        });\n        this.isMultiDepart = false\n      }else if(multi_depart==2){\n        this.visible=true\n        this.isMultiDepart = true\n        this.departList = loginResult.departs\n      }else {\n        this.isMultiDepart = false\n      }\n    },\n    bizTenant(ids){\n      if(!ids || ids.length==0){\n        this.isMultiTenant = false\n      } else if(ids.indexOf(',')<0){\n        this.tenant_id = ids;\n        this.isMultiTenant = false\n      }else{\n        this.visible = true\n        this.isMultiTenant = true\n        getAction('/sys/tenant/queryList', {ids: ids}).then(res=>{\n          this.tenantList = res.result\n        })\n      }\n    },\n    show(loginResult){\n      this.clear();\n      this.bizDepart(loginResult);\n\n      let user = Vue.ls.get(USER_INFO)\n      this.username = user.username\n      let ids = user.relTenantIds\n      this.bizTenant(ids);\n\n      if(this.visible===false){\n        this.$store.dispatch('saveTenant', this.tenant_id);\n        this.$emit('success')\n      }\n\n    },\n    requestFailed (err) {\n      this.$notification[ 'error' ]({\n        message: '登录失败',\n        description: ((err.response || {}).data || {}).message || err.message || \"请求出现错误，请稍后再试\",\n        duration: 4,\n      });\n      this.loginBtn = false;\n    },\n    departResolve(){\n      return new Promise((resolve, reject)=>{\n        if(this.isMultiDepart===false){\n          resolve();\n        }else{\n          let obj = {\n            orgCode:this.orgCode,\n            username:this.username\n          }\n          putAction(\"/sys/selectDepart\",obj).then(res=>{\n            if(res.success){\n              const userInfo = res.result.userInfo;\n              Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000);\n              this.$store.commit('SET_INFO', userInfo);\n              //console.log(\"---切换组织机构---userInfo-------\",store.getters.userInfo.orgCode);\n              resolve();\n            }else{\n              this.requestFailed(res)\n              this.$store.dispatch('Logout');\n              reject();\n            }\n          })\n        }\n      })\n    },\n    selectOk(){\n      if(this.isMultiTenant && !this.tenant_id){\n        this.validate_status1='error'\n        return false\n      }\n      if(this.isMultiDepart && !this.orgCode){\n        this.validate_status2='error'\n        return false\n      }\n      this.departResolve().then(()=>{\n        this.$store.dispatch('saveTenant', this.tenant_id);\n        if(this.isMultiTenant){\n          this.$emit('success')\n        }else{\n          this.$emit('success')\n        }\n      }).catch(()=>{\n        console.log('登录选择出问题')\n      })\n    },\n    handleTenantChange(e){\n      this.validate_status1 = ''\n      this.tenant_id = e\n    },\n    handleDepartChange(e){\n      this.validate_status2 = ''\n      this.orgCode = e\n    }\n  }\n}\n",{"version":3,"sources":["LoginSelectTenant.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoDA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LoginSelectTenant.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\n  <a-modal\n    :title=\"title\"\n    :width=\"450\"\n    :visible=\"visible\"\n    :closable=\"false\"\n    :maskClosable=\"false\">\n\n    <template slot=\"footer\">\n      <a-button type=\"primary\" @click=\"selectOk\">确认</a-button>\n    </template>\n\n    <a-form>\n      <a-form-item v-if=\"isMultiTenant\" :labelCol=\"{span:4}\" :wrapperCol=\"{span:20}\" style=\"margin-bottom:10px\" :validate-status=\"validate_status1\">\n        <a-tooltip placement=\"topLeft\" >\n          <template slot=\"title\">\n            <span>您有多个租户，请选择登录租户</span>\n          </template>\n        <a-avatar style=\"backgroundColor:#87d068\" icon=\"gold\" />\n        </a-tooltip>\n\n        <a-select @change=\"handleTenantChange\" :class=\"{'valid-error':validate_status1=='error'}\" placeholder=\"请选择登录租户\" style=\"margin-left:10px;width: 80%\">\n          <a-icon slot=\"suffixIcon\" type=\"gold\" />\n          <a-select-option v-for=\"d in tenantList\" :key=\"d.id\" :value=\"d.id\">\n            {{ d.name }}\n          </a-select-option>\n        </a-select>\n      </a-form-item>\n\n\n      <a-form-item v-if=\"isMultiDepart\" :labelCol=\"{span:4}\" :wrapperCol=\"{span:20}\" style=\"margin-bottom:10px\" :validate-status=\"validate_status2\">\n        <a-tooltip placement=\"topLeft\" >\n          <template slot=\"title\">\n            <span>您有多个部门，请选择登录部门</span>\n          </template>\n          <a-avatar style=\"backgroundColor:rgb(104, 208, 203);\" icon=\"gold\" />\n        </a-tooltip>\n\n        <a-select @change=\"handleDepartChange\" :class=\"{'valid-error':validate_status2=='error'}\" placeholder=\"请选择登录部门\" style=\"margin-left:10px;width: 80%\">\n          <a-icon slot=\"suffixIcon\" type=\"gold\" />\n          <a-select-option v-for=\"d in departList\" :key=\"d.id\" :value=\"d.orgCode\">\n            {{ d.departName }}\n          </a-select-option>\n        </a-select>\n      </a-form-item>\n\n    </a-form>\n  </a-modal>\n</template>\n\n<script>\n\n  import Vue from 'vue'\n  import { getAction,putAction } from '@/api/manage'\n  import { USER_INFO } from \"@/store/mutation-types\"\n  import store from './Login'\n\n  export default {\n    name: 'LoginSelectTenant',\n    data(){\n      return {\n        visible: false,\n        isMultiDepart:false,\n        departList:[],\n\n        isMultiTenant:false,\n        tenantList:[],\n\n        username:'',\n        orgCode:'',\n        tenant_id:'',\n\n        validate_status1: \"\",\n        validate_status2: \"\",\n      }\n    },\n    computed:{\n      title(){\n        if(this.isMultiDepart && this.isMultiTenant){\n          return '请选择租户和部门'\n        }else if(this.isMultiDepart && !this.isMultiTenant){\n          return '请选择部门'\n        }else if(!this.isMultiDepart && this.isMultiTenant){\n          return '请选择租户'\n        }\n      }\n    },\n    methods:{\n      clear(){\n        this.departList = []\n        this.tenantList = []\n        this.visible=false\n        this.validate_status1=''\n        this.validate_status2=''\n      },\n      bizDepart(loginResult){\n        let multi_depart = loginResult.multi_depart\n        //0:无部门 1:一个部门 2:多个部门\n        if(multi_depart==0){\n          this.$notification.warn({\n            message: '提示',\n            description: `您尚未归属部门,请确认账号信息`,\n            duration:3\n          });\n          this.isMultiDepart = false\n        }else if(multi_depart==2){\n          this.visible=true\n          this.isMultiDepart = true\n          this.departList = loginResult.departs\n        }else {\n          this.isMultiDepart = false\n        }\n      },\n      bizTenant(ids){\n        if(!ids || ids.length==0){\n          this.isMultiTenant = false\n        } else if(ids.indexOf(',')<0){\n          this.tenant_id = ids;\n          this.isMultiTenant = false\n        }else{\n          this.visible = true\n          this.isMultiTenant = true\n          getAction('/sys/tenant/queryList', {ids: ids}).then(res=>{\n            this.tenantList = res.result\n          })\n        }\n      },\n      show(loginResult){\n        this.clear();\n        this.bizDepart(loginResult);\n\n        let user = Vue.ls.get(USER_INFO)\n        this.username = user.username\n        let ids = user.relTenantIds\n        this.bizTenant(ids);\n\n        if(this.visible===false){\n          this.$store.dispatch('saveTenant', this.tenant_id);\n          this.$emit('success')\n        }\n\n      },\n      requestFailed (err) {\n        this.$notification[ 'error' ]({\n          message: '登录失败',\n          description: ((err.response || {}).data || {}).message || err.message || \"请求出现错误，请稍后再试\",\n          duration: 4,\n        });\n        this.loginBtn = false;\n      },\n      departResolve(){\n        return new Promise((resolve, reject)=>{\n          if(this.isMultiDepart===false){\n            resolve();\n          }else{\n            let obj = {\n              orgCode:this.orgCode,\n              username:this.username\n            }\n            putAction(\"/sys/selectDepart\",obj).then(res=>{\n              if(res.success){\n                const userInfo = res.result.userInfo;\n                Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000);\n                this.$store.commit('SET_INFO', userInfo);\n                //console.log(\"---切换组织机构---userInfo-------\",store.getters.userInfo.orgCode);\n                resolve();\n              }else{\n                this.requestFailed(res)\n                this.$store.dispatch('Logout');\n                reject();\n              }\n            })\n          }\n        })\n      },\n      selectOk(){\n        if(this.isMultiTenant && !this.tenant_id){\n          this.validate_status1='error'\n          return false\n        }\n        if(this.isMultiDepart && !this.orgCode){\n          this.validate_status2='error'\n          return false\n        }\n        this.departResolve().then(()=>{\n          this.$store.dispatch('saveTenant', this.tenant_id);\n          if(this.isMultiTenant){\n            this.$emit('success')\n          }else{\n            this.$emit('success')\n          }\n        }).catch(()=>{\n          console.log('登录选择出问题')\n        })\n      },\n      handleTenantChange(e){\n        this.validate_status1 = ''\n        this.tenant_id = e\n      },\n      handleDepartChange(e){\n        this.validate_status2 = ''\n        this.orgCode = e\n      }\n    }\n  }\n</script>\n\n<style scoped>\n\n</style>"]}]}