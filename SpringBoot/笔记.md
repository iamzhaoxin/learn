# 配置文件

## 位置与分类

配置文件分为4类，从高到低覆盖：

- file:config/application.yml
  - 工程路径config目录中的配置文件：服务于运维经理整体调控
- file:application.yml
  - 工程路径配置文件，服务于运维人员配置涉密线上环境
- classpath:config/application.yml
  - 项目类路径config目录中配置文件，
- classpath:application.yml
  - 项目类路径配置文件

## 自定义配置文件

- 通过启动参数加载配置文件
  - --spring.config.name=user  (不用写配置文件拓展名)
  - --spring.config.location=classpath:/user.properties

# 实用开发

## 热部署

步骤：

1. 添加依赖
   ```xml
   <dependency>
     <groupId>org.springframework.boot</groupId>
     <artifactId>spring-boot-devtools</artifactId>
   </dependency>
   ```
2. 修改文件后“Build Project”即可热部署

关于热部署：

- 重启（Restart）：重启自定义开发的代码，restart类加载器
- 重载（Reload）：重载jar包，加载base类加载器

### 自动热部署

1. Setting->Build,E,D->Compiler->Build project automatically
2. Setting->Advanced Setting->Allow auto make .....（IDEA失去焦点5秒后启动热部署）

### 配置热部署范围

springboot配置文件：
spring：devtools：restart：exclude：路径,路径,路径,文件,路径

### 关闭热部署

通过更高优先级的配置，覆盖“开启热部署”

```java
@SpringBootApplication
public class Application {

  public static void main(String[] args) {
      System.setProperty("spring.devtools.restart.enabled","false");
      SpringApplication.run(Application.class, args);
  }

}
```

## 配置高级

> 见项目07

- 报错：Spring Boot Configuration Annotation Processor not configured
- 解决办法：添加依赖 `spring-boot-configuration-processor`

## 数据层

Druid(数据源)+MybatisPlus(持久化)+MySQL(数据库)

### SpringBoot内置数据源

- HikariCP(默认)
- Tomcat提供的DataSource
- Commons DBCP

### 内置持久化

- Jdbc Template

```xml
<dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-jdbc</artifactId>
        </dependency>
```

```java
@Autowired
private JdbcTemplate jdbcTemplate;
void test(){
    String sql="select * from user";
    List<Map<String,Object>> users=jdbcTemplate.querryForList(sql);
}
void test2(){
    String sql="select * from user";
    RowMapper<User> rm=new RowMapper<User>(){
        //.......  
    }
    List<User> users=jdbcTemplate.querry(sql,rm);
}
```

### 内置数据库

#### SQL

- HSQL
- H2
- Derby

可以在内存中启动（测试方便），也可以独立安装

H2：

```xml
<dependency>
            <groupId>略</groupId>
            <artifactId>h2</artifactId>
        </dependency>
```

application.yml

```xml
spring:
  h2:
    console:
      enable: true  # 可访问
      path: /h2
```

访问用户名sa，默认密码123456

## NoSQL

- Redis
- Mongo
- ES

### Redis
（键值对存储，不能存储结构化数据）
1. 导入依赖
2. 配置数据库参数
3. 依赖注入**StringRedisTemplate**（或RedisTemplate），使用ops*获得各种类型操作接口

Redis客户端**lettcus**和**jedis**的区别

- jedis连接Redis数据库是直连模式，多线程时存在线程安全问题，解决方法：配置连接池，使每个连接专用
- lettcus基于Netty框架连接Redis，线程安全，所以一个连接可以被多线程复用

### Mongodb
- 开源、高性能、无模式的文档型数据库
- 临时存储，修改频率高
- NoSQL中，最像 关系型数据库 的 非关系型数据库

## ElasticSearch(ES)
分布式全文搜索
可以通过添加ik插件，对文本切割，查询部分单词
- 整合SpringBoot：
  - 高版本(RestHighLevelClient)需要在代码中配置URI(高版本没有整合到springboot中)
  - 